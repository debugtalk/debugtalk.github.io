<!doctype html><html lang=zh-cn itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>测试结果报表展现：Web页面绘制多层级表格 - DebugTalk</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes"><meta name=MobileOptimized content="width"><meta name=HandheldFriendly content="true"><meta name=applicable-device content="pc,mobile"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=mobile-web-app-capable content="yes"><meta name=author content="debugtalk"><meta name=description content="背景描述 在Android性能测试中，每一个测试任务都对应了1个测试用例、1台测试设备、一个测试包，并且在测试结果中包含了多个指标项。通常，我"><meta name=keywords content="HttpRunner,Python,Go,博客,debugtalk,接口自动化测试,性能测试"><meta name=generator content="Hugo 0.94.2"><link rel=canonical href=https://debugtalk.com/post/render-multi-level-table-in-webpage/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css integrity="sha256-+ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media=screen crossorigin=anonymous><link rel=stylesheet href=/css/custom.css><meta property="og:title" content="测试结果报表展现：Web页面绘制多层级表格"><meta property="og:description" content="背景描述 在Android性能测试中，每一个测试任务都对应了1个测试用例、1台测试设备、一个测试包，并且在测试结果中包含了多个指标项。通常，我"><meta property="og:type" content="article"><meta property="og:url" content="https://debugtalk.com/post/render-multi-level-table-in-webpage/"><meta property="article:section" content="post"><meta property="article:published_time" content="2016-03-20T00:00:00+00:00"><meta property="article:modified_time" content="2016-03-20T00:00:00+00:00"><meta itemprop=name content="测试结果报表展现：Web页面绘制多层级表格"><meta itemprop=description content="背景描述 在Android性能测试中，每一个测试任务都对应了1个测试用例、1台测试设备、一个测试包，并且在测试结果中包含了多个指标项。通常，我"><meta itemprop=datePublished content="2016-03-20T00:00:00+00:00"><meta itemprop=dateModified content="2016-03-20T00:00:00+00:00"><meta itemprop=wordCount content="2281"><meta itemprop=keywords content="报表,JavaScript,"><meta name=twitter:card content="summary"><meta name=twitter:title content="测试结果报表展现：Web页面绘制多层级表格"><meta name=twitter:description content="背景描述 在Android性能测试中，每一个测试任务都对应了1个测试用例、1台测试设备、一个测试包，并且在测试结果中包含了多个指标项。通常，我"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-81639610-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>DebugTalk</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><li class=mobile-menu-item><a class=menu-item-link href=https://debugtalk.com/>主页</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://debugtalk.com/post/>归档</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://debugtalk.com/tags/>标签</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://debugtalk.com/categories/>分类</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://debugtalk.com/about/>关于</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://debugtalk.com/index.xml>订阅</a></li></ul></nav><link rel=stylesheet href=/lib/photoswipe/photoswipe.min.css><link rel=stylesheet href=/lib/photoswipe/default-skin/default-skin.min.css><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header id=header class="header container"><div class=logo-wrapper><a href=/ class=logo>DebugTalk</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=https://debugtalk.com/>主页</a></li><li class=menu-item><a class=menu-item-link href=https://debugtalk.com/post/>归档</a></li><li class=menu-item><a class=menu-item-link href=https://debugtalk.com/tags/>标签</a></li><li class=menu-item><a class=menu-item-link href=https://debugtalk.com/categories/>分类</a></li><li class=menu-item><a class=menu-item-link href=https://debugtalk.com/about/>关于</a></li><li class=menu-item><a class=menu-item-link href=https://debugtalk.com/index.xml>订阅</a></li></ul></nav></header><div id=mobile-panel><main id=main class="main bg-llight"><div class=content-wrapper><div id=content class="content container"><article class="post bg-white"><header class=post-header><h1 class=post-title>测试结果报表展现：Web页面绘制多层级表格</h1><div class=post-meta><time datetime=2016-03-20 class=post-time>2016-03-20</time><div class=post-category><a href=https://debugtalk.com/categories/Development/>Development</a></div><span class=more-meta>约 2281 字</span>
<span class=more-meta>预计阅读 5 分钟</span>
<span id=busuanzi_container_page_pv>| 阅读 <span id=busuanzi_value_page_pv></span></span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#背景描述>背景描述</a></li><li><a href=#第一次尝试绘制2层表格>第一次尝试：绘制2层表格</a></li><li><a href=#第二次尝试绘制3层表格>第二次尝试：绘制3层表格</a></li><li><a href=#重构递归>重构：递归！</a></li></ul></nav></div></div><div class=post-content><h2 id=背景描述>背景描述</h2><p>在Android性能测试中，每一个测试任务都对应了1个测试用例、1台测试设备、一个测试包，并且在测试结果中包含了多个指标项。通常，我们希望能对两个不同版本测试包的测试结果进行对比，并能在Web页面上以表格的形式进行展现。</p><p>很自然地，我们会想到采用如下形式展现对比结果。</p><p><img src=/image/render_table_three_levels.png alt="render table three levels">
图1 三层表格</p><p>对应地，采用如下数据结构存储结果数据。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>data_hash</span> <span class=err>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;pkg_array&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;pkg1&#34;</span><span class=p>,</span> <span class=s2>&#34;pkg2&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;data&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;testcase1&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;device1&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;indicator1&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;value1&#34;</span><span class=p>,</span> <span class=s2>&#34;value2&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;indicator2&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;value3&#34;</span><span class=p>,</span> <span class=s2>&#34;value4&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;device2&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;indicator1&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;value5&#34;</span><span class=p>,</span> <span class=s2>&#34;value6&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;indicator2&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;value7&#34;</span><span class=p>,</span> <span class=s2>&#34;value8&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;testcase2&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;device1&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;indicator1&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;value9&#34;</span><span class=p>,</span> <span class=s2>&#34;value10&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;indicator2&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;value11&#34;</span><span class=p>,</span> <span class=s2>&#34;value12&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;device2&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;indicator1&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;value13&#34;</span><span class=p>,</span> <span class=s2>&#34;value14&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;indicator2&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;value15&#34;</span><span class=p>,</span> <span class=s2>&#34;value16&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>想法明确了，那要怎么实现呢？</p><p>对于像我这样没学过前端的人来说，最难的就是如何通过代码绘制层级表格的问题。</p><h2 id=第一次尝试绘制2层表格>第一次尝试：绘制2层表格</h2><p>为了简化问题分析过程，先尝试对两层表格进行绘制。</p><p><img src=/image/render_table_two_levels.png alt="render table two levels">
图2 两层表格</p><p>简化后的数据结构如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>two_level_data_hash</span> <span class=err>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;pkg_array&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;pkg1&#34;</span><span class=p>,</span> <span class=s2>&#34;pkg2&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;data&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;device1&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;indicator1&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;value1&#34;</span><span class=p>,</span> <span class=s2>&#34;value2&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;indicator2&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;value3&#34;</span><span class=p>,</span> <span class=s2>&#34;value4&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;device2&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;indicator1&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;value5&#34;</span><span class=p>,</span> <span class=s2>&#34;value6&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;indicator2&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;value7&#34;</span><span class=p>,</span> <span class=s2>&#34;value8&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>如上表格对应的html代码如下。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>table</span> <span class=na>border</span><span class=o>=</span><span class=s>&#34;1&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>tr</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>th</span><span class=p>&gt;</span>Device<span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>th</span><span class=p>&gt;</span>Indicator<span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>th</span><span class=p>&gt;</span>Pkg1<span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>th</span><span class=p>&gt;</span>Pkg2<span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>tr</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>tr</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>td</span> <span class=na>rowspan</span><span class=o>=</span><span class=s>&#34;2&#34;</span><span class=p>&gt;</span>device1<span class=p>&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;</span>indicator1<span class=p>&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;</span>value1<span class=p>&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;</span>value2<span class=p>&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>tr</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>tr</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;</span>indicator2<span class=p>&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;</span>value3<span class=p>&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;</span>value4<span class=p>&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>tr</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>table</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>可以看出，绘制层级表格的关键在于<code>tr</code>和<code>rowspan</code>的控制上。
因此，我们可以尝试采用如下JavaScript代码进行生成。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>render_two_level_table</span><span class=p>(</span><span class=nx>two_level_data_hash</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=nx>pkg_array</span> <span class=o>=</span> <span class=nx>two_level_data_hash</span><span class=p>[</span><span class=s2>&#34;pkg_array&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>table_header</span> <span class=o>=</span> <span class=s2>&#34;&lt;tr&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>table_header</span> <span class=o>+=</span> <span class=s2>&#34;&lt;th&gt;Device&lt;/th&gt;&lt;th colspan=&#39;1&#39;&gt;Indicator&lt;/th&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>pkg_index</span> <span class=k>in</span> <span class=nx>pkg_array</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nx>table_header</span> <span class=o>+=</span> <span class=s2>&#34;&lt;th&gt;&#34;</span> <span class=o>+</span> <span class=nx>pkg_array</span><span class=p>[</span><span class=nx>pkg_index</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&#34;&lt;/th&gt;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>table_header</span> <span class=o>+=</span> <span class=s2>&#34;&lt;/tr&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>data</span> <span class=o>=</span> <span class=nx>two_level_data_hash</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>table_body</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>device</span> <span class=k>in</span> <span class=nx>data</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nx>is_first_indicator_row</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>table_body</span> <span class=o>+=</span> <span class=s2>&#34;&lt;tr&gt;&lt;td rowspan=&#39;&#34;</span> <span class=o>+</span> <span class=nx>data</span><span class=p>[</span><span class=nx>device</span><span class=p>].</span><span class=nx>length</span> <span class=o>+</span> <span class=s2>&#34;&#39;&gt;&#34;</span> <span class=o>+</span> <span class=nx>device</span> <span class=o>+</span> <span class=s2>&#34;&lt;/td&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>indicator</span> <span class=k>in</span> <span class=nx>data</span><span class=p>[</span><span class=nx>device</span><span class=p>]){</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>is_first_indicator_row</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nx>table_body</span> <span class=o>+=</span> <span class=s2>&#34;&lt;tr&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>table_body</span> <span class=o>+=</span> <span class=s2>&#34;&lt;td&gt;&#34;</span> <span class=o>+</span> <span class=nx>indicator</span> <span class=o>+</span> <span class=s2>&#34;&lt;/td&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>value_list</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=nx>device</span><span class=p>][</span><span class=nx>indicator</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>index</span> <span class=k>in</span> <span class=nx>value_list</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nx>table_body</span> <span class=o>+=</span> <span class=s2>&#34;&lt;td&gt;&#34;</span> <span class=o>+</span> <span class=nx>value_list</span><span class=p>[</span><span class=nx>index</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&#34;&lt;/td&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>table_body</span> <span class=o>+=</span> <span class=s2>&#34;&lt;/tr&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>is_first_indicator_row</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>table_body</span> <span class=o>+=</span> <span class=s2>&#34;&lt;/tr&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>table_content</span> <span class=o>=</span> <span class=s2>&#34;&lt;table border=&#39;1&#39;&gt;&#34;</span> <span class=o>+</span> <span class=nx>table_header</span> <span class=o>+</span> <span class=nx>table_body</span> <span class=o>+</span> <span class=s2>&#34;&lt;/table&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>$</span><span class=p>(</span><span class=s2>&#34;#table&#34;</span><span class=p>).</span><span class=nx>html</span><span class=p>(</span><span class=nx>table_content</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在绘制indicator单元格的时候，为了判断当前indicator是否是当前device对应的第一个，即是否需要添加<code>&lt;tr></code>格式符，我们引入了<code>is_first_indicator_row</code>变量；<code>is_first_indicator_row</code>初始为true，绘制完第一个indicator以后变为false；绘制当前device剩余indicator的时候，由于<code>is_first_indicator_row</code>为false，因此每次都会加上<code>&lt;tr></code>格式符。</p><p>在判断device单元格的行跨度(<code>rowspan</code>)时，由于indicator是device的key，因此我们可以通过当前device中key的数量来得到<code>rowspan</code>，即<code>two_level_data_hash[device].length</code>。</p><p>绘制下一个device对应的数据时，再重复以上流程。</p><p>可以看出，为了正确打印<code>&lt;tr></code>格式符，我们做了不少工作。两层表格的绘制方法解决了，那如何绘制三层表格呢？</p><h2 id=第二次尝试绘制3层表格>第二次尝试：绘制3层表格</h2><p>回到背景描述里面的需求，若按照上面的思路，我们要绘制三层表格时，就需要引入两个变量，<code>is_first_device_row</code>和<code>is_first_indicator_row</code>，分别用于标记device和indicator是否第一次出现。</p><p>那对于<code>rowspan</code>呢？这貌似就有点麻烦了。因为我们在绘制testcase单元格的时候，<code>rowspan</code>的取值应该是当前testcase包含的所有device各自包含的indicator的数量总和，而我们并不能像之前的方式那样直接得到这个数值。</p><p>那要怎么处理呢？我们可以尝试写一个函数<code>row_num</code>，来计算得到给定JSON数据里面包含的子节点的总数。</p><p>实现方式如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>render_three_level_table</span><span class=p>(</span><span class=nx>data_hash</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=nx>pkg_array</span> <span class=o>=</span> <span class=nx>data_hash</span><span class=p>[</span><span class=s2>&#34;pkg_array&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>table_header</span> <span class=o>=</span> <span class=s2>&#34;&lt;tr&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>table_header</span> <span class=o>+=</span> <span class=s2>&#34;&lt;th&gt;TestCase&lt;/th&gt;&lt;th&gt;Device&lt;/th&gt;&lt;th colspan=&#39;1&#39;&gt;Indicator&lt;/th&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>pkg_index</span> <span class=k>in</span> <span class=nx>pkg_array</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nx>table_header</span> <span class=o>+=</span> <span class=s2>&#34;&lt;th&gt;&#34;</span> <span class=o>+</span> <span class=nx>pkg_array</span><span class=p>[</span><span class=nx>pkg_index</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&#34;&lt;/th&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>table_header</span> <span class=o>+=</span> <span class=s2>&#34;&lt;/tr&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>data</span> <span class=o>=</span> <span class=nx>data_hash</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>table_body</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>testcase</span> <span class=k>in</span> <span class=nx>data</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nx>is_first_row_device</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>table_body</span> <span class=o>+=</span> <span class=s2>&#34;&lt;tr&gt;&lt;td rowspan=&#39;&#34;</span> <span class=o>+</span> <span class=nx>row_num</span><span class=p>(</span><span class=nx>data</span><span class=p>[</span><span class=nx>testcase</span><span class=p>])</span> <span class=o>+</span> <span class=s2>&#34;&#39;&gt;&#34;</span> <span class=o>+</span> <span class=nx>testcase</span> <span class=o>+</span> <span class=s2>&#34;&lt;/td&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>device</span> <span class=k>in</span> <span class=nx>data</span><span class=p>[</span><span class=nx>testcase</span><span class=p>]){</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>is_first_row_device</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nx>table_body</span> <span class=o>+=</span> <span class=s2>&#34;&lt;tr&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>table_body</span> <span class=o>+=</span> <span class=s2>&#34;&lt;td rowspan=&#39;&#34;</span> <span class=o>+</span> <span class=nx>row_num</span><span class=p>(</span><span class=nx>data</span><span class=p>[</span><span class=nx>testcase</span><span class=p>][</span><span class=nx>device</span><span class=p>])</span> <span class=o>+</span> <span class=s2>&#34;&#39;&gt;&#34;</span> <span class=o>+</span> <span class=nx>device</span> <span class=o>+</span> <span class=s2>&#34;&lt;/td&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>is_first_row_indicator</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>indicator</span> <span class=k>in</span> <span class=nx>data</span><span class=p>[</span><span class=nx>testcase</span><span class=p>][</span><span class=nx>device</span><span class=p>]){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>is_first_row_indicator</span><span class=p>){</span>
</span></span><span class=line><span class=cl>          <span class=nx>table_body</span> <span class=o>+=</span> <span class=s2>&#34;&lt;tr&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>table_body</span> <span class=o>+=</span> <span class=s2>&#34;&lt;td&gt;&#34;</span> <span class=o>+</span> <span class=nx>indicator</span> <span class=o>+</span> <span class=s2>&#34;&lt;/td&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>value_list</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=nx>testcase</span><span class=p>][</span><span class=nx>device</span><span class=p>][</span><span class=nx>indicator</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>index</span> <span class=k>in</span> <span class=nx>value_list</span><span class=p>){</span>
</span></span><span class=line><span class=cl>          <span class=nx>table_body</span> <span class=o>+=</span> <span class=s2>&#34;&lt;td&gt;&#34;</span> <span class=o>+</span> <span class=nx>value_list</span><span class=p>[</span><span class=nx>index</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&#34;&lt;/td&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>table_body</span> <span class=o>+=</span> <span class=s2>&#34;&lt;/tr&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>table_body</span> <span class=o>+=</span> <span class=s2>&#34;&lt;/tr&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>is_first_row_indicator</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>table_body</span> <span class=o>+=</span> <span class=s2>&#34;&lt;/tr&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>is_first_row_device</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>table_content</span> <span class=o>=</span> <span class=s2>&#34;&lt;table border=&#39;1&#39;&gt;&#34;</span> <span class=o>+</span> <span class=nx>table_header</span> <span class=o>+</span> <span class=nx>table_body</span> <span class=o>+</span> <span class=s2>&#34;&lt;/table&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>$</span><span class=p>(</span><span class=s2>&#34;#table&#34;</span><span class=p>).</span><span class=nx>html</span><span class=p>(</span><span class=nx>table_content</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>row_num</span><span class=p>(</span><span class=nx>data</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>counter</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>constructor</span> <span class=o>==</span> <span class=nb>Array</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=nx>key</span> <span class=k>in</span> <span class=nx>data</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>tmp</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=nx>key</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>tmp</span><span class=p>.</span><span class=nx>constructor</span> <span class=o>==</span> <span class=nb>Array</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span> <span class=o>+=</span> <span class=nx>row_num</span><span class=p>(</span><span class=nx>tmp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>counter</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在计算<code>rowspan</code>时，我们用到了递归的方法，实现了对当前testcase或当前device所对应的indicator总数的计算。</p><p>通过以上方式，我们实现了三层表格的绘制。可以看出，三层表格的判断逻辑比两层表格复杂了很多，那如果我们还想绘制更多层次的表格呢？显然，这种方法已不再适用，我们不可能每增加一层就新增加一个标识变量，而且对于数据层级不固定的情况，采用这种方式是完全无法实现自适应的。</p><h2 id=重构递归>重构：递归！</h2><p>回顾上面的代码，我们不难发现，三层表格的代码相比于两层表格的代码，存在着不少重复，而且可以预见，如果我们采用同样的方式去绘制更多层次表格的话，重复的代码会出现得更多。</p><p>一定有更简洁的方法！对，递归！</p><p>其实刚才我们在计算<code>rowspan</code>时已经体会到了递归的好处，它可以自适应多层次的数据结构。我们也完全可以将这个思想应用到表格层级的绘制上面。</p><p>观察背景描述中的数据结构，不难发现，对比数据存储于Array中，而中间层的value都是Hash结构，因此，我们可以通过这个区别，编写递归调用方法。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>render_table</span><span class=p>(</span><span class=nx>data_hash</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>res</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>key</span> <span class=k>in</span> <span class=nx>data_hash</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>tmp</span> <span class=o>=</span> <span class=nx>data_hash</span><span class=p>[</span><span class=nx>key</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>tmp</span><span class=p>.</span><span class=nx>constructor</span> <span class=o>==</span> <span class=nb>Array</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span> <span class=o>+=</span> <span class=s2>&#34;&lt;tr&gt;&lt;td rowspan=&#39;&#34;</span> <span class=o>+</span> <span class=nx>row_num</span><span class=p>(</span><span class=nx>tmp</span><span class=p>)</span><span class=o>+</span> <span class=s2>&#34;&#39;&gt;&#34;</span> <span class=o>+</span> <span class=nx>key</span> <span class=o>+</span> <span class=s2>&#34;&lt;/td&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>for</span><span class=p>(</span><span class=nx>value_index</span> <span class=k>in</span> <span class=nx>tmp</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>value</span> <span class=o>=</span> <span class=nx>tmp</span><span class=p>[</span><span class=nx>value_index</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span> <span class=o>+=</span> <span class=s2>&#34;&lt;td&gt;&#34;</span> <span class=o>+</span> <span class=nx>value</span> <span class=o>+</span> <span class=s2>&#34;&lt;/td&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span> <span class=o>+=</span> <span class=s2>&#34;&lt;/tr&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span> <span class=o>+=</span> <span class=s2>&#34;&lt;tr&gt;&lt;td rowspan=&#39;&#34;</span> <span class=o>+</span> <span class=nx>row_num</span><span class=p>(</span><span class=nx>tmp</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;&#39;&gt;&#34;</span> <span class=o>+</span> <span class=nx>key</span> <span class=o>+</span> <span class=s2>&#34;&lt;/td&gt;&#34;</span> <span class=o>+</span> <span class=s2>&#34;&lt;/tr&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span> <span class=o>+=</span> <span class=nx>render_table</span><span class=p>(</span><span class=nx>tmp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>row_num</span><span class=p>(</span><span class=nx>data</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>counter</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>constructor</span> <span class=o>==</span> <span class=nb>Array</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>counter</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=nx>key</span> <span class=k>in</span> <span class=nx>data</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>tmp</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=nx>key</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>tmp</span><span class=p>.</span><span class=nx>constructor</span> <span class=o>==</span> <span class=nb>Array</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span> <span class=o>+=</span> <span class=nx>row_num</span><span class=p>(</span><span class=nx>tmp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>counter</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>table_body</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>table_body</span> <span class=o>+=</span> <span class=nx>render_table</span><span class=p>(</span><span class=nx>data_hash</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>采用了递归的方式以后，我们就不用再关注表格的层级了，只要是传入数据的数据结构与背景描述里面的类似，那么就可以自动绘制出任意层级的表格。</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>debugtalk</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2016-03-20</span></p><p class=copyright-item><span class=item-title>许可协议</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></p></div><footer class=post-footer><div class=post-tags><a href=https://debugtalk.com/tags/%E6%8A%A5%E8%A1%A8/>报表</a>
<a href=https://debugtalk.com/tags/JavaScript/>JavaScript</a></div><nav class=post-nav><a class=prev href=/post/cheat-in-wechat-moments-voting-activity/><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg></i><span class="prev-text nav-default">微信朋友圈投票活动的刷票案例分析</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/post/developing-idea-production-data-picker/><span class="next-text nav-default">【灵感】线上数据采摘工具（ProductionDataPicker）</span>
<span class="prev-text nav-mobile">下一篇</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697c-11.777231-11.500939-30.216186-10.304694-41.178865 2.712784z"/></svg></i></a></nav></footer></article><div class="post bg-white"><script src=https://utteranc.es/client.js repo=debugtalk/debugtalk.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div></div></main><footer id=footer class=footer><div class=icon-links><a href=mailto:mail@debugtalk.com rel="me noopener" class=iconfont title=email><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408h399.992405s71.046998 3.997201 71.046998 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zm53.281707 130.131124C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523S0 1024 83.726336 1024H682.532949 753.579947h595.368192C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955c-39.771477 34.470494-74.671786 43.295855-98.955861 43.868928z"/></svg></a><a href=https://github.com/debugtalk rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04C242.005334 929.664 211.968 830.08 211.968 830.08 188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg></a><a href=https://debugtalk.com/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a></span>
<span class=copyright-year>&copy;
2011 -
2022
<span class=heart><i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg></i></span><span class=author>debugtalk</span></span>
<span id=busuanzi_container>访客数/访问量：<span id=busuanzi_value_site_uv></span>/<span id=busuanzi_value_site_pv></span></span></div></footer><div class=back-to-top id=back-to-top><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg></i></div></div><script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/load-photoswipe.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script src=/js/custom.js></script></body></html>