<!doctype html><html lang=zh-cn itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>HttpRunner 的测试用例分层机制（适用于 2.X） - DebugTalk</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes">
<meta name=MobileOptimized content="width">
<meta name=HandheldFriendly content="true">
<meta name=applicable-device content="pc,mobile">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=mobile-web-app-capable content="yes">
<meta name=author content="debugtalk">
<meta name=description content="背景描述 在《HttpRunner 2.0 正式发布》中提到，HttpRunner 从 2.0 版本开始，对测试用例组织形式进行了较大的调整，更正了之前在自动化">
<meta name=keywords content="HttpRunner,Python,Go,博客,debugtalk,接口自动化测试,性能测试">
<meta name=generator content="Hugo 0.92.1">
<link rel=canonical href=https://debugtalk.github.io/post/HttpRunner-testcase-layer-2x/>
<link rel=icon href=/favicon.ico>
<link rel=stylesheet href=/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css integrity="sha256-+ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media=screen crossorigin=anonymous>
<link rel=stylesheet href=/css/custom.css>
<meta property="og:title" content="HttpRunner 的测试用例分层机制（适用于 2.X）">
<meta property="og:description" content="背景描述 在《HttpRunner 2.0 正式发布》中提到，HttpRunner 从 2.0 版本开始，对测试用例组织形式进行了较大的调整，更正了之前在自动化">
<meta property="og:type" content="article">
<meta property="og:url" content="https://debugtalk.github.io/post/HttpRunner-testcase-layer-2x/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2019-04-18T00:00:00+00:00">
<meta property="article:modified_time" content="2019-04-18T00:00:00+00:00">
<meta itemprop=name content="HttpRunner 的测试用例分层机制（适用于 2.X）">
<meta itemprop=description content="背景描述 在《HttpRunner 2.0 正式发布》中提到，HttpRunner 从 2.0 版本开始，对测试用例组织形式进行了较大的调整，更正了之前在自动化"><meta itemprop=datePublished content="2019-04-18T00:00:00+00:00">
<meta itemprop=dateModified content="2019-04-18T00:00:00+00:00">
<meta itemprop=wordCount content="2727">
<meta itemprop=keywords content="HttpRunner,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="HttpRunner 的测试用例分层机制（适用于 2.X）">
<meta name=twitter:description content="背景描述 在《HttpRunner 2.0 正式发布》中提到，HttpRunner 从 2.0 版本开始，对测试用例组织形式进行了较大的调整，更正了之前在自动化"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-81639610-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>DebugTalk</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/>主页</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/post/>归档</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/tags/>标签</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/categories/>分类</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/about/>关于</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/index.xml>订阅</a>
</li>
</ul>
</nav>
<link rel=stylesheet href=/lib/photoswipe/photoswipe.min.css>
<link rel=stylesheet href=/lib/photoswipe/default-skin/default-skin.min.css>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<header id=header class="header container">
<div class=logo-wrapper>
<a href=/ class=logo>
DebugTalk
</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/>主页</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/post/>归档</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/tags/>标签</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/categories/>分类</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/about/>关于</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/index.xml>订阅</a>
</li>
</ul>
</nav>
</header>
<div id=mobile-panel>
<main id=main class="main bg-llight">
<div class=content-wrapper>
<div id=content class="content container">
<article class="post bg-white">
<header class=post-header>
<h1 class=post-title>HttpRunner 的测试用例分层机制（适用于 2.X）</h1>
<div class=post-meta>
<time datetime=2019-04-18 class=post-time>
2019-04-18
</time>
<div class=post-category>
<a href=https://debugtalk.github.io/categories/OpenSource/> OpenSource </a>
</div>
<span class=more-meta> 约 2727 字 </span>
<span class=more-meta> 预计阅读 6 分钟 </span>
<span id=busuanzi_container_page_pv>
| 阅读 <span id=busuanzi_value_page_pv></span>
</span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>文章目录</h2>
<div class=post-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#背景描述>背景描述</a></li>
<li><a href=#测试用例分层模型>测试用例分层模型</a></li>
<li><a href=#分层描述详解>分层描述详解</a>
<ul>
<li><a href=#接口定义api>接口定义（API）</a></li>
<li><a href=#测试用例testcase>测试用例（testcase）</a></li>
<li><a href=#测试用例集testsuite>测试用例集（testsuite）</a></li>
</ul>
</li>
<li><a href=#文件目录结构管理--脚手架工具>文件目录结构管理 && 脚手架工具</a></li>
<li><a href=#相关参考>相关参考</a></li>
</ul>
</nav>
</div>
</div>
<div class=post-content>
<h2 id=背景描述>背景描述</h2>
<p>在<a href=/post/httprunner-2.0-release>《HttpRunner 2.0 正式发布》</a>中提到，HttpRunner 从 2.0 版本开始，对测试用例组织形式进行了较大的调整，更正了之前在自动化测试概念上的偏差。</p>
<p>对应地，测试用例分层机制也进行了重新设计，因此在概念和使用方法方面都会出现很大的差异。本文便是对新的测试用例分层机制进行介绍。</p>
<h2 id=测试用例分层模型>测试用例分层模型</h2>
<p>关于为什么要使用测试用例分层机制，在<a href=/post/HttpRunner-testcase-layer>《HttpRunner 的测试用例分层机制（已过期）》</a>中已经进行了详细的介绍，虽然使用方法变化了，但原理上都是相同的。</p>
<p>概括来说，测试用例分层机制的核心是将接口定义、测试步骤、测试用例、测试场景进行分离，单独进行描述和维护，从而尽可能地减少自动化测试用例的维护成本。</p>
<p>逻辑关系图如下所示：</p>
<p><img src=/images/20190418145309.png alt></p>
<p>同时，强调如下几点核心概念：</p>
<ul>
<li>测试用例（testcase）应该是完整且独立的，每条测试用例应该是都可以独立运行的</li>
<li>测试用例是测试步骤（teststep）的 <code>有序</code> 集合，每一个测试步骤对应一个 API 的请求描述</li>
<li>测试用例集（testsuite）是测试用例的 <code>无序</code> 集合，集合中的测试用例应该都是相互独立，不存在先后依赖关系的；如果确实存在先后依赖关系，那就需要在测试用例中完成依赖的处理</li>
</ul>
<p>如果对于上述第三点感觉难以理解，不妨看下上图中的示例：</p>
<ul>
<li>testcase1 依赖于 testcase2，那么就可以在测试步骤（teststep12）中对 testcase2 进行引用，然后 testcase1 就是完整且可独立运行的；</li>
<li>在 testsuite 中，testcase1 与 testcase2 相互独立，运行顺序就不再有先后依赖关系了。</li>
</ul>
<h2 id=分层描述详解>分层描述详解</h2>
<p>理解了测试用例分层模型，接下来我们再来看下在分层模型下，接口、测试用例、测试用例集的描述形式。</p>
<h3 id=接口定义api>接口定义（API）</h3>
<p>为了更好地对接口描述进行管理，推荐使用独立的文件对接口描述进行存储，即每个文件对应一个接口描述。</p>
<p>接口定义描述的主要内容包括：<strong>name</strong>、variables、<strong>request</strong>、base_url、validate 等，形式如下：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>get headers</span><span class=w>
</span><span class=w></span><span class=nt>base_url</span><span class=p>:</span><span class=w> </span><span class=l>http://httpbin.org</span><span class=w>
</span><span class=w></span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>expected_status_code</span><span class=p>:</span><span class=w> </span><span class=m>200</span><span class=w>
</span><span class=w></span><span class=nt>request</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>/headers</span><span class=w>
</span><span class=w>    </span><span class=nt>method</span><span class=p>:</span><span class=w> </span><span class=l>GET</span><span class=w>
</span><span class=w></span><span class=nt>validate</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>eq</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;status_code&#34;</span><span class=p>,</span><span class=w> </span><span class=l>$expected_status_code]</span><span class=w>
</span><span class=w>    </span>- <span class=nt>eq</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>content.headers.Host, &#34;httpbin.org&#34;]</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><p>其中，name 和 request 部分是必须的，request 中的描述形式与 <a href=http://docs.python-requests.org/en/master/api/>requests.request</a> 完全相同。</p>
<p>另外，API 描述需要尽量保持完整，做到可以单独运行。如果在接口描述中存在变量引用的情况，可在 variables 中对参数进行定义。通过这种方式，可以很好地实现单个接口的调试。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ hrun api/get_headers.yml
INFO     Start to run testcase: get headers
headers
INFO     GET http://httpbin.org/headers
INFO     status_code: 200, response_time<span class=o>(</span>ms<span class=o>)</span>: 477.32 ms, response_length: <span class=m>157</span> bytes

.

----------------------------------------------------------------------
Ran <span class=m>1</span> <span class=nb>test</span> in 0.478s

OK
</code></pre></td></tr></table>
</div>
</div><h3 id=测试用例testcase>测试用例（testcase）</h3>
<h4 id=引用接口定义>引用接口定义</h4>
<p>有了接口的定义描述后，我们编写测试场景时就可以直接引用接口定义了。</p>
<p>在测试步骤（teststep）中，可通过 <code>api</code> 字段引用接口定义，引用方式为对应 API 文件的路径，绝对路径或相对路径均可。推荐使用相对路径，路径基准为项目根目录，即 <code>debugtalk.py</code> 所在的目录路径。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml>- <span class=nt>config</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;setup and reset all.&#34;</span><span class=w>
</span><span class=w>    </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>user_agent</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;iOS/10.3&#39;</span><span class=w>
</span><span class=w>        </span><span class=nt>device_sn</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;TESTCASE_SETUP_XXX&#34;</span><span class=w>
</span><span class=w>        </span><span class=nt>os_platform</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;ios&#39;</span><span class=w>
</span><span class=w>        </span><span class=nt>app_version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;2.8.6&#39;</span><span class=w>
</span><span class=w>    </span><span class=nt>base_url</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://127.0.0.1:5000&#34;</span><span class=w>
</span><span class=w>    </span><span class=nt>verify</span><span class=p>:</span><span class=w> </span><span class=kc>False</span><span class=w>
</span><span class=w>    </span><span class=nt>output</span><span class=p>:</span><span class=w>
</span><span class=w>        </span>- <span class=l>session_token</span><span class=w>
</span><span class=w>
</span><span class=w></span>- <span class=nt>test</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>get token (setup)</span><span class=w>
</span><span class=w>    </span><span class=nt>api</span><span class=p>:</span><span class=w> </span><span class=l>api/get_token.yml</span><span class=w>
</span><span class=w>    </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>user_agent</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;iOS/10.3&#39;</span><span class=w>
</span><span class=w>        </span><span class=nt>device_sn</span><span class=p>:</span><span class=w> </span><span class=l>$device_sn</span><span class=w>
</span><span class=w>        </span><span class=nt>os_platform</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;ios&#39;</span><span class=w>
</span><span class=w>        </span><span class=nt>app_version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;2.8.6&#39;</span><span class=w>
</span><span class=w>    </span><span class=nt>extract</span><span class=p>:</span><span class=w>
</span><span class=w>        </span>- <span class=nt>session_token</span><span class=p>:</span><span class=w> </span><span class=l>content.token</span><span class=w>
</span><span class=w>    </span><span class=nt>validate</span><span class=p>:</span><span class=w>
</span><span class=w>        </span>- <span class=nt>eq</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;status_code&#34;</span><span class=p>,</span><span class=w> </span><span class=m>200</span><span class=p>]</span><span class=w>
</span><span class=w>        </span>- <span class=nt>len_eq</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;content.token&#34;</span><span class=p>,</span><span class=w> </span><span class=m>16</span><span class=p>]</span><span class=w>
</span><span class=w>
</span><span class=w></span>- <span class=nt>test</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>reset all users</span><span class=w>
</span><span class=w>    </span><span class=nt>api</span><span class=p>:</span><span class=w> </span><span class=l>api/reset_all.yml</span><span class=w>
</span><span class=w>    </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>token</span><span class=p>:</span><span class=w> </span><span class=l>$session_token</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><p>若需要控制或改变接口定义中的参数值，可在测试步骤中指定 variables 参数，覆盖 API 中的 variables 实现。</p>
<p>同样地，在测试步骤中定义 validate 后，也会与 API 中的 validate 合并覆盖。因此推荐的做法是，在 API 定义中的 validate 只描述最基本的校验项，例如 status_code，对于与业务逻辑相关的更多校验项，在测试步骤的 validate 中进行描述。</p>
<h4 id=引用测试用例>引用测试用例</h4>
<p>在测试用例的测试步骤中，除了可以引用接口定义，还可以引用其它测试用例。通过这种方式，可以在避免重复描述的同时，解决测试用例的依赖关系，从而保证每个测试用例都是独立可运行的。</p>
<p>在测试步骤（teststep）中，可通过 <code>testcase</code> 字段引用其它测试用例，引用方式为对应测试用例文件的路径，绝对路径或相对路径均可。推荐使用相对路径，路径基准为项目根目录，即 <code>debugtalk.py</code> 所在的目录路径。</p>
<p>例如，在上面的测试用例（&ldquo;setup and reset all."）中，实现了对获取 token 功能的测试；同时，在很多其它功能中都会依赖于获取 token 的功能，如果将该功能的测试步骤脚本拷贝到其它功能的测试用例中，那么就会存在大量重复，当需要对该部分进行修改时就需要修改所有地方，显然不便于维护。</p>
<p>比较好的做法是，在其它功能的测试用例（如创建用户）中，引用获取 token 功能的测试用例（testcases/setup.yml）作为一个测试步骤，从而创建用户（&ldquo;create user and check result."）这个测试用例也变得独立可运行了。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml>- <span class=nt>config</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;create user and check result.&#34;</span><span class=w>
</span><span class=w>    </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>create_user</span><span class=w>
</span><span class=w>    </span><span class=nt>base_url</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://127.0.0.1:5000&#34;</span><span class=w>
</span><span class=w>    </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>uid</span><span class=p>:</span><span class=w> </span><span class=m>9001</span><span class=w>
</span><span class=w>        </span><span class=nt>device_sn</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;TESTCASE_CREATE_XXX&#34;</span><span class=w>
</span><span class=w>    </span><span class=nt>output</span><span class=p>:</span><span class=w>
</span><span class=w>        </span>- <span class=l>session_token</span><span class=w>
</span><span class=w>
</span><span class=w></span>- <span class=nt>test</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>setup and reset all (override) for $device_sn.</span><span class=w>
</span><span class=w>    </span><span class=nt>testcase</span><span class=p>:</span><span class=w> </span><span class=l>testcases/setup.yml</span><span class=w>
</span><span class=w>    </span><span class=nt>output</span><span class=p>:</span><span class=w>
</span><span class=w>        </span>- <span class=l>session_token</span><span class=w>
</span><span class=w>
</span><span class=w></span>- <span class=nt>test</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>create user and check result.</span><span class=w>
</span><span class=w>    </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>token</span><span class=p>:</span><span class=w> </span><span class=l>$session_token</span><span class=w>
</span><span class=w>    </span><span class=nt>testcase</span><span class=p>:</span><span class=w> </span><span class=l>testcases/deps/check_and_create.yml</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><h3 id=测试用例集testsuite>测试用例集（testsuite）</h3>
<p>当测试用例数量比较多以后，为了方便管理和实现批量运行，通常需要使用测试用例集来对测试用例进行组织。</p>
<p>在前文的测试用例分层模型中也强调了，测试用例集（testsuite）是测试用例的 <code>无序</code> 集合，集合中的测试用例应该都是相互独立，不存在先后依赖关系的；如果确实存在先后依赖关系，那就需要在测试用例中完成依赖的处理。</p>
<p>因为是 <code>无序</code> 集合，因此测试用例集的描述形式会与测试用例有些不同，在每个测试用例集文件中，第一层级存在两类字段：</p>
<ul>
<li>config: 测试用例集的总体配置参数</li>
<li>testcases: 值为字典结构（无序），key 为测试用例的名称，value 为测试用例的内容；在引用测试用例时也可以指定 variables，实现对引用测试用例中 variables 的覆盖。</li>
</ul>
<h4 id=非参数化场景>非参数化场景</h4>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=nt>config</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>create users with uid</span><span class=w>
</span><span class=w>    </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>device_sn</span><span class=p>:</span><span class=w> </span><span class=l>${gen_random_string(15)}</span><span class=w>
</span><span class=w>        </span><span class=nt>var_a</span><span class=p>:</span><span class=w> </span><span class=l>${gen_random_string(5)}</span><span class=w>
</span><span class=w>        </span><span class=nt>var_b</span><span class=p>:</span><span class=w> </span><span class=l>$var_a</span><span class=w>
</span><span class=w>    </span><span class=nt>base_url</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://127.0.0.1:5000&#34;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>testcases</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>create user 1000 and check result.</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>testcase</span><span class=p>:</span><span class=w> </span><span class=l>testcases/create_user.yml</span><span class=w>
</span><span class=w>        </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span><span class=w>            </span><span class=nt>uid</span><span class=p>:</span><span class=w> </span><span class=m>1000</span><span class=w>
</span><span class=w>            </span><span class=nt>var_c</span><span class=p>:</span><span class=w> </span><span class=l>${gen_random_string(5)}</span><span class=w>
</span><span class=w>            </span><span class=nt>var_d</span><span class=p>:</span><span class=w> </span><span class=l>$var_c</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=nt>create user 1001 and check result.</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>testcase</span><span class=p>:</span><span class=w> </span><span class=l>testcases/create_user.yml</span><span class=w>
</span><span class=w>        </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span><span class=w>            </span><span class=nt>uid</span><span class=p>:</span><span class=w> </span><span class=m>1001</span><span class=w>
</span><span class=w>            </span><span class=nt>var_c</span><span class=p>:</span><span class=w> </span><span class=l>${gen_random_string(5)}</span><span class=w>
</span><span class=w>            </span><span class=nt>var_d</span><span class=p>:</span><span class=w> </span><span class=l>$var_c</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><h4 id=参数化场景parameters>参数化场景（parameters）</h4>
<p>对于参数化场景，可通过 parameters 实现，描述形式如下所示。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=nt>config</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>create users with parameters</span><span class=w>
</span><span class=w>    </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>device_sn</span><span class=p>:</span><span class=w> </span><span class=l>${gen_random_string(15)}</span><span class=w>
</span><span class=w>    </span><span class=nt>base_url</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://127.0.0.1:5000&#34;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>testcases</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>create user $uid and check result for $device_sn.</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>testcase</span><span class=p>:</span><span class=w> </span><span class=l>testcases/create_user.yml</span><span class=w>
</span><span class=w>        </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span><span class=w>            </span><span class=nt>uid</span><span class=p>:</span><span class=w> </span><span class=m>1000</span><span class=w>
</span><span class=w>            </span><span class=nt>device_sn</span><span class=p>:</span><span class=w> </span><span class=l>TESTSUITE_XXX</span><span class=w>
</span><span class=w>        </span><span class=nt>parameters</span><span class=p>:</span><span class=w>
</span><span class=w>            </span><span class=nt>uid</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=m>101</span><span class=p>,</span><span class=w> </span><span class=m>102</span><span class=p>,</span><span class=w> </span><span class=m>103</span><span class=p>]</span><span class=w>
</span><span class=w>            </span><span class=nt>device_sn</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>TESTSUITE_X1, TESTSUITE_X2]</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><p>参数化后，parameters 中的变量将采用笛卡尔积组合形成参数列表，依次覆盖 variables 中的参数，驱动测试用例的运行。</p>
<h2 id=文件目录结构管理--脚手架工具>文件目录结构管理 && 脚手架工具</h2>
<p>在对测试用例文件进行组织管理时，对于文件的存储位置均没有要求和限制，在引用时只需要指定对应的文件路径即可。但从约定大于配置的角度，最好是按照推荐的文件夹名称进行存储管理，并可通过子目录实现项目模块分类管理。</p>
<p>总结如下：</p>
<ul>
<li><code>debugtalk.py</code> 放置在项目根目录下，假设为 <code>PRJ_ROOT_DIR</code></li>
<li>接口定义（API）放置在 <code>PRJ_ROOT_DIR/api</code> 目录下</li>
<li>测试用例（testcase）放置在 <code>PRJ_ROOT_DIR/testcases</code> 目录下</li>
<li>测试用例集（testsuite）文件必须放置在 <code>PRJ_ROOT_DIR/testsuite</code> 目录下</li>
</ul>
<p>目录结构如下所示：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ tree tests
tests
├── api
│   ├── create_user.yml
│   ├── get_headers.yml
│   ├── get_token.yml
│   ├── get_user.yml
│   └── reset_all.yml
├── debugtalk.py
├── testcases
│   ├── create_user.yml
│   ├── deps
│   │   └── check_and_create.yml
│   └── setup.yml
└── testsuites
    ├── create_users.yml
    └── create_users_with_parameters.yml
</code></pre></td></tr></table>
</div>
</div><p>同时，在 <code>HttpRunner</code> 中实现了一个脚手架工具，可以快速创建项目的目录结构。该想法来源于 <code>Django</code> 的 <code>django-admin.py startproject project_name</code>。</p>
<p>使用方式也与 <code>Django</code> 类似，只需要通过 <code>--startproject</code> 指定新项目的名称即可。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ hrun --startproject demo
Start to create new project: demo
CWD: /Users/debugtalk/MyProjects/examples

created folder: demo
created folder: demo/api
created folder: demo/testcases
created folder: demo/testsuites
created folder: demo/reports
created file: demo/debugtalk.py
created file: demo/.env
</code></pre></td></tr></table>
</div>
</div><h2 id=相关参考>相关参考</h2>
<ul>
<li><a href=/post/HttpRunner-testcase-layer>《HttpRunner 的测试用例分层机制（已过期）》</a></li>
<li>测试用例分层详细示例：<a href=https://github.com/HttpRunner/HttpRunner/tree/master/tests>HttpRunner/tests</a></li>
</ul>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span class=item-title>文章作者</span>
<span class=item-content>debugtalk</span>
</p>
<p class=copyright-item>
<span class=item-title>上次更新</span>
<span class=item-content>
2019-04-18
</span>
</p>
<p class=copyright-item>
<span class=item-title>许可协议</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span>
</p>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=https://debugtalk.github.io/tags/HttpRunner/>HttpRunner</a>
</div>
<nav class=post-nav>
<a class=prev href=/post/dji-graduated/>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg>
</i>
<span class="prev-text nav-default">写在大疆毕业之际</span>
<span class="prev-text nav-mobile">上一篇</span>
</a>
<a class=next href=/post/my-2018-summary/>
<span class="next-text nav-default">我的 2018 年终总结</span>
<span class="prev-text nav-mobile">下一篇</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697c-11.777231-11.500939-30.216186-10.304694-41.178865 2.712784z"/></svg>
</i>
</a>
</nav>
</footer>
</article>
<div class="post bg-white">
<script src=https://utteranc.es/client.js repo=debugtalk/debugtalk.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script>
</div>
</div>
</div>
</main>
<footer id=footer class=footer>
<div class=icon-links>
<a href=mailto:mail@debugtalk.com rel="me noopener" class=iconfont title=email><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408h399.992405s71.046998 3.997201 71.046998 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zm53.281707 130.131124C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523S0 1024 83.726336 1024H682.532949 753.579947h595.368192C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955c-39.771477 34.470494-74.671786 43.295855-98.955861 43.868928z"/></svg>
</a>
<a href=https://github.com/debugtalk rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04C242.005334 929.664 211.968 830.08 211.968 830.08 188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg>
</a>
<a href=https://debugtalk.github.io/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg>
</a>
</div>
<div class=copyright>
<span class=power-by>
Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span>
<span class=division>|</span>
<span class=theme-info>
Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a>
</span>
<span class=copyright-year>
&copy;
2015 -
2022
<span class=heart>
<i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg>
</i>
</span><span class=author>
debugtalk
</span></span>
<span id=busuanzi_container>
访客数/访问量：<span id=busuanzi_value_site_uv></span>/<span id=busuanzi_value_site_pv></span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg>
</i>
</div>
</div>
<script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/load-photoswipe.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script src=/js/custom.js></script>
</body>
</html>