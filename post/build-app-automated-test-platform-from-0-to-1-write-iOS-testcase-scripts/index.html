<!doctype html><html lang=zh-cn itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>从0到1搭建移动App功能自动化测试平台（3）：编写iOS自动化测试脚本 - DebugTalk</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes">
<meta name=MobileOptimized content="width">
<meta name=HandheldFriendly content="true">
<meta name=applicable-device content="pc,mobile">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=mobile-web-app-capable content="yes">
<meta name=author content="debugtalk">
<meta name=description content="通过前面三篇文章，我们已经将iOS自动化功能测试的开发环境全部准备就绪，也学习了iOS UI控件交互操作的一般性方法，接下来，就可以开始编写自">
<meta name=keywords content="HttpRunner,Python,Go,博客,debugtalk,接口自动化测试,性能测试">
<meta name=generator content="Hugo 0.92.1">
<link rel=canonical href=https://debugtalk.github.io/post/build-app-automated-test-platform-from-0-to-1-write-iOS-testcase-scripts/>
<link rel=icon href=/favicon.ico>
<link rel=stylesheet href=/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css integrity="sha256-+ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media=screen crossorigin=anonymous>
<link rel=stylesheet href=/css/custom.css>
<meta property="og:title" content="从0到1搭建移动App功能自动化测试平台（3）：编写iOS自动化测试脚本">
<meta property="og:description" content="通过前面三篇文章，我们已经将iOS自动化功能测试的开发环境全部准备就绪，也学习了iOS UI控件交互操作的一般性方法，接下来，就可以开始编写自">
<meta property="og:type" content="article">
<meta property="og:url" content="https://debugtalk.github.io/post/build-app-automated-test-platform-from-0-to-1-write-iOS-testcase-scripts/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2016-05-30T00:00:00+00:00">
<meta property="article:modified_time" content="2016-05-30T00:00:00+00:00">
<meta itemprop=name content="从0到1搭建移动App功能自动化测试平台（3）：编写iOS自动化测试脚本">
<meta itemprop=description content="通过前面三篇文章，我们已经将iOS自动化功能测试的开发环境全部准备就绪，也学习了iOS UI控件交互操作的一般性方法，接下来，就可以开始编写自"><meta itemprop=datePublished content="2016-05-30T00:00:00+00:00">
<meta itemprop=dateModified content="2016-05-30T00:00:00+00:00">
<meta itemprop=wordCount content="3509">
<meta itemprop=keywords content="Appium,iOS,Python,Ruby,AppiumBooster,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="从0到1搭建移动App功能自动化测试平台（3）：编写iOS自动化测试脚本">
<meta name=twitter:description content="通过前面三篇文章，我们已经将iOS自动化功能测试的开发环境全部准备就绪，也学习了iOS UI控件交互操作的一般性方法，接下来，就可以开始编写自"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-81639610-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>DebugTalk</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/>主页</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/post/>归档</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/tags/>标签</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/categories/>分类</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/about/>关于</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/index.xml>订阅</a>
</li>
</ul>
</nav>
<link rel=stylesheet href=/lib/photoswipe/photoswipe.min.css>
<link rel=stylesheet href=/lib/photoswipe/default-skin/default-skin.min.css>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<header id=header class="header container">
<div class=logo-wrapper>
<a href=/ class=logo>
DebugTalk
</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/>主页</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/post/>归档</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/tags/>标签</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/categories/>分类</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/about/>关于</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.github.io/index.xml>订阅</a>
</li>
</ul>
</nav>
</header>
<div id=mobile-panel>
<main id=main class="main bg-llight">
<div class=content-wrapper>
<div id=content class="content container">
<article class="post bg-white">
<header class=post-header>
<h1 class=post-title>从0到1搭建移动App功能自动化测试平台（3）：编写iOS自动化测试脚本</h1>
<div class=post-meta>
<time datetime=2016-05-30 class=post-time>
2016-05-30
</time>
<div class=post-category>
<a href=https://debugtalk.github.io/categories/OpenSource/> OpenSource </a>
</div>
<span class=more-meta> 约 3509 字 </span>
<span class=more-meta> 预计阅读 8 分钟 </span>
<span id=busuanzi_container_page_pv>
| 阅读 <span id=busuanzi_value_page_pv></span>
</span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>文章目录</h2>
<div class=post-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#语言的选择python-or-ruby>语言的选择：Python or Ruby？</a></li>
<li><a href=#第一个测试用例系统登录>第一个测试用例：系统登录</a></li>
<li><a href=#优化测试脚本加入等待机制>优化测试脚本：加入等待机制</a></li>
<li><a href=#优化测试脚本加入结果检测机制>优化测试脚本：加入结果检测机制</a></li>
<li><a href=#to-be-continued->To be continued &mldr;</a></li>
</ul>
</nav>
</div>
</div>
<div class=post-content>
<p>通过前面三篇文章，我们已经将iOS自动化功能测试的开发环境全部准备就绪，也学习了iOS UI控件交互操作的一般性方法，接下来，就可以开始编写自动化测试脚本了。</p>
<p>在本文中，我将在M项目中挑选一个功能点，对其编写自动化测试脚本，演示编写自动化测试用例的整个流程。</p>
<h2 id=语言的选择python-or-ruby>语言的选择：Python or Ruby？</h2>
<p>之前介绍Appium的时候也提到，Appium采用Client-Server的架构设计，并采用标准的HTTP通信协议；Client端基本上可以采用任意主流编程语言编写测试用例，包括但不限于C#、Ruby、Objective-C、Java、node.js、Python、PHP。</p>
<p>因此，在开始编写自动化测试脚本之前，首先需要选定一门编程语言。</p>
<p>这个选择因人而异，并不涉及到太大的优劣之分，基本上在上述几门语言中选择自己最熟悉的就好。</p>
<p>但对我而言，选择却没有那么干脆，前段时间在Python和Ruby之间犹豫了很久，经过艰难的决定，最终选择了Ruby。为什么不考虑Java？不熟是一方面，另一方面是觉得采用编译型语言写测试用例总感觉太重，这活儿还是解释型语言来做更合适些。</p>
<p>其实，最开始本来是想选择Python的，因为Python在软件测试领域比Ruby应用得更广，至少在国内，不管是公司团队，还是测试人员群体，使用Python的会比使用Ruby的多很多。</p>
<p>那为什么还是选择了Ruby呢？</p>
<p>我主要是基于如下几点考虑的：</p>
<ul>
<li>从Appium的官方文档来看，Appium对Ruby的支持力度，或者说是偏爱程度，貌似会更大些；在<a href=http://appium.io/downloads.html>Appium Client Libraries</a>列表中将Ruby排在第一位就不说了，在<a href="http://appium.io/tutorial.html?lang=en">Appium Tutorials</a>中示例语言就只采用了Ruby和Java进行描述。</li>
<li><a href=https://github.com/appium/ruby_lib>Appium_Console</a>是采用Ruby编写的，在Console中执行的命令基本上可直接用在Ruby脚本中。</li>
<li>后续打算引入BDD（行为驱动开发）的测试模式，而不管是cucumber还是RSpec，都是采用Ruby开发的。</li>
</ul>
<p>当然，还有最最重要的一点，身处于珠江三角洲最大的Ruby阵营，周围Ruby大牛云集，公司的好多业务系统也都是采用Rails作为后台语言，完全没理由不选择Ruby啊。</p>
<h2 id=第一个测试用例系统登录>第一个测试用例：系统登录</h2>
<p>在测试领域中，系统登录这个功能点的地位，堪比软件开发中的<code>Hello World</code>，因此第一个测试用例就毫无悬念地选择系统登录了。</p>
<p>在编写自动化测试脚本之前，我们首先需要清楚用例执行的路径，路径中操作涉及到的控件，以及被操作控件的属性信息。</p>
<p>对于本次演示的APP来说，登录时需要先进入【My Account】页面，然后点击【Login】进入登录页面，接着在登录页面中输入账号密码后再点击【Login】按钮，完成登录操作。</p>
<p><img src=/images/DebugTalk_Plus_Login.jpg alt="Preview of DebugTalk Plus login"></p>
<p>确定了操作路径以后，就可以在<code>Appium Ruby Console</code>中依次操作一遍，目的是确保代码能正确地对控件进行操作。</p>
<p>第一步要点击【My Account】按钮，因此先查看下Button控件属性。要是不确定目标控件的类型，可以直接执行<code>page</code>命令，然后在返回结果中根据控件名称进行查找。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=o>[</span>1<span class=o>]</span> pry<span class=o>(</span>main<span class=o>)</span>&gt; page :button
...（略）
UIAButton
   name, label: My Account
   id: My <span class=nv>Account</span> <span class=o>=</span>&gt; My Account
nil
</code></pre></td></tr></table>
</div>
</div><p>通过返回结果，可以看到【My Account】按钮的name、label属性就是“My Account”，因此可以通过<code>button_exact('My Account')</code>方式来定位控件，并进行点击操作。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=o>[</span>2<span class=o>]</span> pry<span class=o>(</span>main<span class=o>)</span>&gt; button_exact<span class=o>(</span><span class=s1>&#39;My Account&#39;</span><span class=o>)</span>.click
nil
</code></pre></td></tr></table>
</div>
</div><p>执行命令后，观察iOS模拟器中APP的响应情况，看是否成功进入“My Account”页面。</p>
<p>第二步也是类似的，操作代码如下：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=o>[</span>3<span class=o>]</span> pry<span class=o>(</span>main<span class=o>)</span>&gt; button_exact<span class=o>(</span><span class=s1>&#39;Login&#39;</span><span class=o>)</span>.click
nil
</code></pre></td></tr></table>
</div>
</div><p>进入到登录页面后，再次查看页面中的控件信息：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=o>[</span>4<span class=o>]</span> pry<span class=o>(</span>main<span class=o>)</span>&gt; page
...（略）
UIATextField
   value: Email Address
   id: Email <span class=nv>Address</span> <span class=o>=</span>&gt; Email Address
UIASecureTextField
   value: Password <span class=o>(</span>6-16 characters<span class=o>)</span>
   id: Password <span class=o>(</span>6-16 characters<span class=o>)</span> <span class=o>=</span>&gt; Password <span class=o>(</span>6-16 characters<span class=o>)</span>
UIAButton
   name, label: Login
   id: Log <span class=nv>In</span> <span class=o>=</span>&gt; Login
       <span class=nv>登录</span>     <span class=o>=</span>&gt; Login
...（略）
</code></pre></td></tr></table>
</div>
</div><p>第三步需要填写账号密码，账号密码的控件属性分别是<code>UIATextField</code>和<code>UIASecureTextField</code>。由于这两个控件的类型在登录页面都是唯一的，因此可以采用控件的类型来进行定位，然后进行输入操作，代码如下：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=o>[</span>5<span class=o>]</span> pry<span class=o>(</span>main<span class=o>)</span>&gt; tag<span class=o>(</span><span class=s1>&#39;UIATextField&#39;</span><span class=o>)</span>.type <span class=s1>&#39;leo.lee@debugtalk.com&#39;</span>
<span class=s2>&#34;&#34;</span>
<span class=o>[</span>6<span class=o>]</span> pry<span class=o>(</span>main<span class=o>)</span>&gt; tag<span class=o>(</span><span class=s1>&#39;UIASecureTextField&#39;</span><span class=o>)</span>.type <span class=s1>&#39;123456&#39;</span>
<span class=s2>&#34;&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>执行完输入命令后，在iOS模拟器中可以看到账号密码输入框都成功输入了内容。</p>
<p>最后第四步点击【Login】按钮，操作上和第二步完全一致。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=o>[</span>7<span class=o>]</span> pry<span class=o>(</span>main<span class=o>)</span>&gt; button_exact<span class=o>(</span><span class=s1>&#39;Login&#39;</span><span class=o>)</span>.click
nil
</code></pre></td></tr></table>
</div>
</div><p>执行完以上四个步骤后，在iOS模拟器中看到成功完成账号登录操作，这说明我们的执行命令没有问题，可以用于编写自动化测试代码。整合起来，测试脚本就是下面这样。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=n>button_exact</span><span class=p>(</span><span class=s1>&#39;My Account&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>click</span>
<span class=n>button_exact</span><span class=p>(</span><span class=s1>&#39;Login&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>click</span>
<span class=n>tag</span><span class=p>(</span><span class=s1>&#39;UIATextField&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>type</span> <span class=s1>&#39;leo.lee@debugtalk.com&#39;</span>
<span class=n>tag</span><span class=p>(</span><span class=s1>&#39;UIASecureTextField&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>type</span> <span class=s1>&#39;12345678&#39;</span>
<span class=n>button_exact</span><span class=p>(</span><span class=s1>&#39;Login&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>click</span>
</code></pre></td></tr></table>
</div>
</div><p>将以上脚本保存为<code>login.rb</code>文件。</p>
<p>但当我们直接运行<code>login.rb</code>文件时，并不能运行成功。原因很简单，脚本中的<code>button_exact</code>、<code>tag</code>这些方法并没有定义，我们在文件中也没有引入相关库文件。</p>
<p>在上一篇文章中有介绍过，通过<code>arc</code>启动虚拟机时，会从<code>appium.txt</code>中读取虚拟机的配置信息。类似的，我们在脚本中执行自动化测试时，也会加载虚拟机，因此同样需要在脚本中指定虚拟机的配置信息，并初始化<code>Appium Driver</code>的实例。</p>
<p>初始化代码可以通过<code>Appium Inspector</code>生成，基本上为固定模式，我们暂时不用深究。</p>
<p>添加初始化部分的代码后，测试脚本如下所示。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=nb>require</span> <span class=s1>&#39;rubygems&#39;</span>
<span class=nb>require</span> <span class=s1>&#39;appium_lib&#39;</span>

<span class=n>capabilities</span> <span class=o>=</span> <span class=p>{</span>
  <span class=s1>&#39;appium-version&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;1.0&#39;</span><span class=p>,</span>
  <span class=s1>&#39;platformName&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;iOS&#39;</span><span class=p>,</span>
  <span class=s1>&#39;platformVersion&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;9.3&#39;</span><span class=p>,</span>
<span class=p>}</span>
<span class=no>Appium</span><span class=o>::</span><span class=no>Driver</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=ss>caps</span><span class=p>:</span> <span class=n>capabilities</span><span class=p>)</span><span class=o>.</span><span class=n>start_driver</span>
<span class=no>Appium</span><span class=o>.</span><span class=n>promote_appium_methods</span> <span class=no>Object</span>

<span class=c1># testcase: login</span>
<span class=n>button_exact</span><span class=p>(</span><span class=s1>&#39;My Account&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>click</span>
<span class=n>button_exact</span><span class=p>(</span><span class=s1>&#39;Login&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>click</span>
<span class=n>tag</span><span class=p>(</span><span class=s1>&#39;UIATextField&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>type</span> <span class=s1>&#39;leo.lee@debugtalk.com&#39;</span>
<span class=n>tag</span><span class=p>(</span><span class=s1>&#39;UIASecureTextField&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>type</span> <span class=s1>&#39;123456&#39;</span>
<span class=n>button_exact</span><span class=p>(</span><span class=s1>&#39;Login&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>click</span>

<span class=n>driver_quit</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=优化测试脚本加入等待机制>优化测试脚本：加入等待机制</h2>
<p>如上测试脚本编写好后，在Terminal中运行<code>ruby login.rb</code>，就可以执行脚本了。</p>
<p>运行命令后，会看到iOS虚拟机成功启动，接着App成功进行加载，然后自动按照前面设计的路径，执行系统登录流程。</p>
<p>但是，在实际操作过程中，发现有时候运行脚本时会出现找不到控件的异常，异常信息如下所示：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>➜ ruby login.rb
/Library/Ruby/Gems/2.0.0/gems/appium_lib-8.0.2/lib/appium_lib/common/helper.rb:218:in <span class=sb>`</span>_no_such_element<span class=s1>&#39;: An element could not be located on the page using the given search parameters. (Selenium::WebDriver::Error::NoSuchElementError)
</span><span class=s1>	from /Library/Ruby/Gems/2.0.0/gems/appium_lib-8.0.2/lib/appium_lib/ios/helper.rb:578:in `ele_by_json&#39;</span>
	from /Library/Ruby/Gems/2.0.0/gems/appium_lib-8.0.2/lib/appium_lib/ios/helper.rb:367:in <span class=sb>`</span>ele_by_json_visible_exact<span class=s1>&#39;
</span><span class=s1>	from /Library/Ruby/Gems/2.0.0/gems/appium_lib-8.0.2/lib/appium_lib/ios/element/button.rb:41:in `button_exact&#39;</span>
	from /Library/Ruby/Gems/2.0.0/gems/appium_lib-8.0.2/lib/appium_lib/driver.rb:226:in <span class=sb>`</span>rescue in block <span class=o>(</span><span class=m>4</span> levels<span class=o>)</span> in promote_appium_methods<span class=s1>&#39;
</span><span class=s1>	from /Library/Ruby/Gems/2.0.0/gems/appium_lib-8.0.2/lib/appium_lib/driver.rb:217:in `block (4 levels) in promote_appium_methods&#39;</span>
	from login.rb:28:in <span class=sb>`</span>&lt;main&gt;<span class=err>&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>更奇怪的是，这个异常并不是稳定出现的，有时候能正常运行整个用例，但有时在某个步骤就会抛出找不到控件的异常。这是什么原因呢？为什么在<code>Appium Ruby Console</code>中单步操作时就不会出现这个问题，但是在执行脚本的时候就会偶尔出现异常呢？</p>
<p>原来，在我们之前的脚本中，两条命令之间并没有间隔时间，有可能前一条命令执行完后，模拟器中的应用还没有完成下一个页面的加载，下一条命令就又开始查找控件，然后由于找不到控件就抛出异常了。</p>
<p>这也是为什么我们在<code>Appium Ruby Console</code>中没有出现这样的问题。因为手工输入命令多少会有一些耗时，输入两条命令的间隔时间足够虚拟机中的APP完成下一页面的加载了。</p>
<p>那针对这种情况，我们要怎么修改测试脚本呢？难道要在每一行代码之间都添加休眠（sleep）函数么？</p>
<p>也不用这么麻烦，针对这类情况，<code>ruby_lib</code>实现了<code>wait</code>机制。将执行命令放入到<code>wait{}</code>中后，执行脚本时就会等待该命令执行完成后再去执行下一条命令。当然，等待也不是无休止的，如果等待30秒后还是没有执行完，仍然会抛出异常。</p>
<p>登录流程的测试脚本修改后如下所示（已省略初始化部分的代码）：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=n>wait</span> <span class=p>{</span> <span class=n>button_exact</span><span class=p>(</span><span class=s1>&#39;My Account&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>click</span> <span class=p>}</span>
<span class=n>wait</span> <span class=p>{</span> <span class=n>button_exact</span><span class=p>(</span><span class=s1>&#39;Login&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>click</span> <span class=p>}</span>
<span class=n>wait</span> <span class=p>{</span> <span class=n>tag</span><span class=p>(</span><span class=s1>&#39;UIATextField&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>type</span> <span class=s1>&#39;leo.lee@debugtalk.com&#39;</span> <span class=p>}</span>
<span class=n>wait</span> <span class=p>{</span> <span class=n>tag</span><span class=p>(</span><span class=s1>&#39;UIASecureTextField&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>type</span> <span class=s1>&#39;123456&#39;</span> <span class=p>}</span>
<span class=n>wait</span> <span class=p>{</span> <span class=n>button_exact</span><span class=p>(</span><span class=s1>&#39;Login&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>click</span> <span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>对脚本添加<code>wait</code>机制后，之前出现的找不到控件的异常就不再出现了。</p>
<h2 id=优化测试脚本加入结果检测机制>优化测试脚本：加入结果检测机制</h2>
<p>然而，现在脚本仍然不够完善。</p>
<p>我们在<code>Appium Ruby Console</code>中手工执行命令后，都是由人工肉眼确认虚拟机中APP是否成功进入下一个页面，或者返回结果是否正确。</p>
<p>但是在执行自动化测试脚本时，我们不可能一直去盯着模拟器。因此，我们还需要在脚本中加入结果检测机制，通过脚本实现结果正确性的检测。</p>
<p>具体怎么做呢？</p>
<p>原理也很简单，只需要在下一个页面中，寻找一个在前一个页面中没有的控件。</p>
<p>例如，由A页面跳转至B页面，在B页面中会存在“Welcome”的文本控件，但是在A页面中是没有这个“Welcome”文本控件的；那么，我们就可以在脚本中的跳转页面语句之后，加入一条检测“Welcome”文本控件的语句；后续在执行测试脚本的时候，如果页面跳转失败，就会因为找不到控件而抛出异常，我们也能通过这个异常知道测试执行失败了。</p>
<p>当然，对下一页面中的控件进行检测时同样需要加入等待机制的。</p>
<p>登录流程的测试脚本修改后如下所示（已省略初始化部分的代码）：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=n>wait</span> <span class=p>{</span> <span class=n>button_exact</span><span class=p>(</span><span class=s1>&#39;My Account&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>click</span> <span class=p>}</span>
<span class=n>wait</span> <span class=p>{</span> <span class=n>text_exact</span> <span class=s1>&#39;System Settings&#39;</span> <span class=p>}</span>

<span class=n>wait</span> <span class=p>{</span> <span class=n>button_exact</span><span class=p>(</span><span class=s1>&#39;Login&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>click</span> <span class=p>}</span>
<span class=n>wait</span> <span class=p>{</span> <span class=n>button_exact</span> <span class=s1>&#39;Forget password?&#39;</span> <span class=p>}</span>

<span class=n>wait</span> <span class=p>{</span> <span class=n>tag</span><span class=p>(</span><span class=s1>&#39;UIATextField&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>type</span> <span class=s1>&#39;leo.lee@debugtalk.com&#39;</span> <span class=p>}</span>
<span class=n>wait</span> <span class=p>{</span> <span class=n>tag</span><span class=p>(</span><span class=s1>&#39;UIASecureTextField&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>type</span> <span class=s1>&#39;12345678&#39;</span> <span class=p>}</span>
<span class=n>wait</span> <span class=p>{</span> <span class=n>button_exact</span><span class=p>(</span><span class=s1>&#39;Login&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>click</span> <span class=p>}</span>
<span class=n>wait</span> <span class=p>{</span> <span class=n>text_exact</span> <span class=s1>&#39;My Message&#39;</span> <span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>至此，系统登录流程的自动化测试脚本我们就编写完成了。</p>
<h2 id=to-be-continued->To be continued &mldr;</h2>
<p>在本文中，我们通过系统登录这一典型功能点，演示了编写自动化测试用例的整个流程。</p>
<p>在下一篇文章中，我们还会对自动化测试脚本的结构进行进一步优化，并实现测试代码工程化。</p>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span class=item-title>文章作者</span>
<span class=item-content>debugtalk</span>
</p>
<p class=copyright-item>
<span class=item-title>上次更新</span>
<span class=item-content>
2016-05-30
</span>
</p>
<p class=copyright-item>
<span class=item-title>许可协议</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span>
</p>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=https://debugtalk.github.io/tags/Appium/>Appium</a>
<a href=https://debugtalk.github.io/tags/iOS/>iOS</a>
<a href=https://debugtalk.github.io/tags/Python/>Python</a>
<a href=https://debugtalk.github.io/tags/Ruby/>Ruby</a>
<a href=https://debugtalk.github.io/tags/AppiumBooster/>AppiumBooster</a>
</div>
<nav class=post-nav>
<a class=prev href=/post/confluence-simple-tutorial/>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg>
</i>
<span class="prev-text nav-default">敏捷团队协作：Confluence简易教程</span>
<span class="prev-text nav-mobile">上一篇</span>
</a>
<a class=next href=/post/build-app-automated-test-platform-from-0-to-1-Appium-interrogate-iOS-UI/>
<span class="next-text nav-default">从0到1搭建移动App功能自动化测试平台（2）：操作iOS应用的控件</span>
<span class="prev-text nav-mobile">下一篇</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697c-11.777231-11.500939-30.216186-10.304694-41.178865 2.712784z"/></svg>
</i>
</a>
</nav>
</footer>
</article>
<div class="post bg-white">
<script src=https://utteranc.es/client.js repo=debugtalk/debugtalk.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script>
</div>
</div>
</div>
</main>
<footer id=footer class=footer>
<div class=icon-links>
<a href=mailto:mail@debugtalk.com rel="me noopener" class=iconfont title=email><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408h399.992405s71.046998 3.997201 71.046998 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zm53.281707 130.131124C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523S0 1024 83.726336 1024H682.532949 753.579947h595.368192C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955c-39.771477 34.470494-74.671786 43.295855-98.955861 43.868928z"/></svg>
</a>
<a href=https://github.com/debugtalk rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04C242.005334 929.664 211.968 830.08 211.968 830.08 188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg>
</a>
<a href=https://debugtalk.github.io/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg>
</a>
</div>
<div class=copyright>
<span class=power-by>
Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span>
<span class=division>|</span>
<span class=theme-info>
Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a>
</span>
<span class=copyright-year>
&copy;
2015 -
2022
<span class=heart>
<i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg>
</i>
</span><span class=author>
debugtalk
</span></span>
<span id=busuanzi_container>
访客数/访问量：<span id=busuanzi_value_site_uv></span>/<span id=busuanzi_value_site_pv></span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg>
</i>
</div>
</div>
<script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/load-photoswipe.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script src=/js/custom.js></script>
</body>
</html>