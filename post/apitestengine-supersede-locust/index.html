<!doctype html><html lang=zh-cn itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>ApiTestEngine 集成 Locust 实现更好的性能测试体验 - DebugTalk</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes">
<meta name=MobileOptimized content="width">
<meta name=HandheldFriendly content="true">
<meta name=applicable-device content="pc,mobile">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=mobile-web-app-capable content="yes">
<meta name=author content="debugtalk">
<meta name=description content="ApiTestEngine不是接口测试框架么，也能实现性能测试？ 是的，你没有看错，ApiTestEngine集成了Locust性能测试框架，">
<meta name=keywords content="HttpRunner,Python,Go,博客,debugtalk,接口自动化测试,性能测试">
<meta name=generator content="Hugo 0.92.1">
<link rel=canonical href=https://debugtalk.com/post/apitestengine-supersede-locust/>
<link rel=icon href=/favicon.ico>
<link rel=stylesheet href=/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css integrity="sha256-+ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media=screen crossorigin=anonymous>
<link rel=stylesheet href=/css/custom.css>
<meta property="og:title" content="ApiTestEngine 集成 Locust 实现更好的性能测试体验">
<meta property="og:description" content="ApiTestEngine不是接口测试框架么，也能实现性能测试？ 是的，你没有看错，ApiTestEngine集成了Locust性能测试框架，">
<meta property="og:type" content="article">
<meta property="og:url" content="https://debugtalk.com/post/apitestengine-supersede-locust/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2017-08-27T00:00:00+00:00">
<meta property="article:modified_time" content="2017-08-27T00:00:00+00:00">
<meta itemprop=name content="ApiTestEngine 集成 Locust 实现更好的性能测试体验">
<meta itemprop=description content="ApiTestEngine不是接口测试框架么，也能实现性能测试？ 是的，你没有看错，ApiTestEngine集成了Locust性能测试框架，"><meta itemprop=datePublished content="2017-08-27T00:00:00+00:00">
<meta itemprop=dateModified content="2017-08-27T00:00:00+00:00">
<meta itemprop=wordCount content="5060">
<meta itemprop=keywords content="HttpRunner,Locust,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="ApiTestEngine 集成 Locust 实现更好的性能测试体验">
<meta name=twitter:description content="ApiTestEngine不是接口测试框架么，也能实现性能测试？ 是的，你没有看错，ApiTestEngine集成了Locust性能测试框架，"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-81639610-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>DebugTalk</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.com/>主页</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.com/post/>归档</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.com/tags/>标签</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.com/categories/>分类</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.com/about/>关于</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.com/index.xml>订阅</a>
</li>
</ul>
</nav>
<link rel=stylesheet href=/lib/photoswipe/photoswipe.min.css>
<link rel=stylesheet href=/lib/photoswipe/default-skin/default-skin.min.css>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<header id=header class="header container">
<div class=logo-wrapper>
<a href=/ class=logo>
DebugTalk
</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.com/>主页</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.com/post/>归档</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.com/tags/>标签</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.com/categories/>分类</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.com/about/>关于</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.com/index.xml>订阅</a>
</li>
</ul>
</nav>
</header>
<div id=mobile-panel>
<main id=main class="main bg-llight">
<div class=content-wrapper>
<div id=content class="content container">
<article class="post bg-white">
<header class=post-header>
<h1 class=post-title>ApiTestEngine 集成 Locust 实现更好的性能测试体验</h1>
<div class=post-meta>
<time datetime=2017-08-27 class=post-time>
2017-08-27
</time>
<div class=post-category>
<a href=https://debugtalk.com/categories/OpenSource/> OpenSource </a>
</div>
<span class=more-meta> 约 5060 字 </span>
<span class=more-meta> 预计阅读 11 分钟 </span>
<span id=busuanzi_container_page_pv>
| 阅读 <span id=busuanzi_value_page_pv></span>
</span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>文章目录</h2>
<div class=post-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#灵感来源>灵感来源</a></li>
<li><a href=#灵感初探>灵感初探</a></li>
<li><a href=#优化1自动生成locustfile>优化1：自动生成locustfile</a></li>
<li><a href=#优化2一键启动多个locust实例>优化2：一键启动多个locust实例</a></li>
<li><a href=#最终实现效果>最终实现效果</a></li>
</ul>
</nav>
</div>
</div>
<div class=post-content>
<p><a href=https://github.com/debugtalk/ApiTestEngine><code>ApiTestEngine</code></a>不是接口测试框架么，也能实现性能测试？</p>
<p>是的，你没有看错，<a href=https://github.com/debugtalk/ApiTestEngine><code>ApiTestEngine</code></a>集成了<a href=http://locust.io/><code>Locust</code></a>性能测试框架，只需一份测试用例，就能同时实现接口自动化测试和接口性能测试，在不改变<a href=http://locust.io/><code>Locust</code></a>任何特性的情况下，甚至比<code>Locust</code>本身更易用。</p>
<p>如果你还没有接触过<a href=http://locust.io/><code>Locust</code></a>这款性能测试工具，那么这篇文章可能不适合你。但我还是强烈推荐你了解一下这款工具。简单地说，<a href=http://locust.io/><code>Locust</code></a>是一款采用<code>Python</code>语言编写实现的开源性能测试工具，简洁、轻量、高效，并发机制基于<code>gevent</code>协程，可以实现单机模拟生成较高的并发压力。关于<a href=http://locust.io/><code>Locust</code></a>的特性介绍和使用教程，我之前已经写过不少，你们可以在我的博客中找到<a href=https://debugtalk.com/tags/Locust/>对应文章</a>。</p>
<p>如果你对实现的过程没有兴趣，可以直接跳转到文章底部，看<code>最终实现效果</code>章节。</p>
<h2 id=灵感来源>灵感来源</h2>
<p>在当前市面上的测试工具中，接口测试和性能测试基本上是两个泾渭分明的领域。这也意味着，针对同一个系统的服务端接口，我们要对其实现接口自动化测试和接口性能测试时，通常都是采用不同的工具，分别维护两份测试脚本或用例。</p>
<p>之前我也是这么做的。但是在做了一段时间后我就在想，不管是接口功能测试，还是接口性能测试，核心都是要模拟对接口发起请求，然后对接口响应内容进行解析和校验；唯一的差异在于，接口性能测试存在并发的概念，相当于模拟了大量用户同时在做接口测试。</p>
<p>既然如此，那接口自动化测试用例和接口性能测试脚本理应可以合并为一套，这样就可以避免重复的脚本开发工作了。</p>
<p>在开发<a href=https://github.com/debugtalk/ApiTestEngine><code>ApiTestEngine</code></a>的过程中，之前的文章也说过，<a href=https://github.com/debugtalk/ApiTestEngine><code>ApiTestEngine</code></a>完全基于<a href=http://docs.python-requests.org/en/master/><code>Python-Requests</code></a>库实现HTTP的请求处理，可以在编写接口测试用例时复用到<a href=http://docs.python-requests.org/en/master/><code>Python-Requests</code></a>的所有功能特性。而之前在学习<a href=http://locust.io/><code>Locust</code></a>的源码时，发现<a href=http://locust.io/><code>Locust</code></a>在实现HTTP请求的时候，也完全是基于<a href=http://docs.python-requests.org/en/master/><code>Python-Requests</code></a>库。</p>
<p>在这一层关系的基础上，我提出一个大胆的设想，能否通过一些方式或手段，可以使<a href=https://github.com/debugtalk/ApiTestEngine><code>ApiTestEngine</code></a>中编写的<code>YAML/JSON</code>格式的接口测试用例，也能直接让<a href=http://locust.io/><code>Locust</code></a>直接调用呢？</p>
<h2 id=灵感初探>灵感初探</h2>
<p>想法有了以后，就开始探索实现的方法了。</p>
<p>首先，我们可以看下<a href=http://locust.io/><code>Locust</code></a>的脚本形式。如下例子是一个比较简单的场景（截取自官网首页）。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>locust</span> <span class=kn>import</span> <span class=n>HttpLocust</span><span class=p>,</span> <span class=n>TaskSet</span><span class=p>,</span> <span class=n>task</span>

<span class=k>class</span> <span class=nc>WebsiteTasks</span><span class=p>(</span><span class=n>TaskSet</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>on_start</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;/login&#34;</span><span class=p>,</span> <span class=p>{</span>
            <span class=s2>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;test_user&#34;</span><span class=p>,</span>
            <span class=s2>&#34;password&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
        <span class=p>})</span>

    <span class=nd>@task</span>
    <span class=k>def</span> <span class=nf>index</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span>

    <span class=nd>@task</span>
    <span class=k>def</span> <span class=nf>about</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/about/&#34;</span><span class=p>)</span>

<span class=k>class</span> <span class=nc>WebsiteUser</span><span class=p>(</span><span class=n>HttpLocust</span><span class=p>):</span>
    <span class=n>task_set</span> <span class=o>=</span> <span class=n>WebsiteTasks</span>
    <span class=n>min_wait</span> <span class=o>=</span> <span class=mi>5000</span>
    <span class=n>max_wait</span> <span class=o>=</span> <span class=mi>15000</span>
</code></pre></td></tr></table>
</div>
</div><p>在<a href=http://locust.io/><code>Locust</code></a>的脚本中，我们会在<code>TaskSet</code>子类中描述单个用户的行为，每一个带有<code>@task</code>装饰器的方法都对应着一个HTTP请求场景。而<a href=http://locust.io/><code>Locust</code></a>的一个很大特点就是，所有的测试用例脚本都是<code>Python</code>文件，因此我们可以采用Python实现各种复杂的场景。</p>
<p>等等！模拟单个用户请求，而且还是纯粹的Python语言，我们不是在接口测试中已经实现的功能么？</p>
<p>例如，下面的代码就是从单元测试中截取的测试用例。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>test_run_testset</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
    <span class=n>testcase_file_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>getcwd</span><span class=p>(),</span> <span class=s1>&#39;examples/quickstart-demo-rev-3.yml&#39;</span><span class=p>)</span>
    <span class=n>testsets</span> <span class=o>=</span> <span class=n>utils</span><span class=o>.</span><span class=n>load_testcases_by_path</span><span class=p>(</span><span class=n>testcase_file_path</span><span class=p>)</span>
    <span class=n>results</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>test_runner</span><span class=o>.</span><span class=n>run_testset</span><span class=p>(</span><span class=n>testsets</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</code></pre></td></tr></table>
</div>
</div><p><code>test_runner.run_testset</code>是已经在<code>ApiTestEngine</code>中实现的方法，作用是传入测试用例（<code>YAML/JSON</code>）的路径，然后就可以加载测试用例，运行整个测试场景。并且，由于我们在测试用例<code>YAML/JSON</code>中已经描述了<code>validators</code>，即接口的校验部分，因此我们也无需再对接口响应结果进行校验描述了。</p>
<p>接下来，实现方式就非常简单了。</p>
<p>我们只需要制作一个<code>locustfile.py</code>的模板文件，内容如下。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=c1>#coding: utf-8</span>
<span class=kn>import</span> <span class=nn>zmq</span>
<span class=kn>import</span> <span class=nn>os</span>
<span class=kn>from</span> <span class=nn>locust</span> <span class=kn>import</span> <span class=n>HttpLocust</span><span class=p>,</span> <span class=n>TaskSet</span><span class=p>,</span> <span class=n>task</span>
<span class=kn>from</span> <span class=nn>ate</span> <span class=kn>import</span> <span class=n>utils</span><span class=p>,</span> <span class=n>runner</span>

<span class=k>class</span> <span class=nc>WebPageTasks</span><span class=p>(</span><span class=n>TaskSet</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>on_start</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>test_runner</span> <span class=o>=</span> <span class=n>runner</span><span class=o>.</span><span class=n>Runner</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>testset</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>locust</span><span class=o>.</span><span class=n>testset</span>

    <span class=nd>@task</span>
    <span class=k>def</span> <span class=nf>test_specified_scenario</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
       <span class=bp>self</span><span class=o>.</span><span class=n>test_runner</span><span class=o>.</span><span class=n>run_testset</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>testset</span><span class=p>)</span>

<span class=k>class</span> <span class=nc>WebPageUser</span><span class=p>(</span><span class=n>HttpLocust</span><span class=p>):</span>
    <span class=n>host</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
    <span class=n>task_set</span> <span class=o>=</span> <span class=n>WebPageTasks</span>
    <span class=n>min_wait</span> <span class=o>=</span> <span class=mi>1000</span>
    <span class=n>max_wait</span> <span class=o>=</span> <span class=mi>5000</span>

    <span class=n>testcase_file_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>getcwd</span><span class=p>(),</span> <span class=s1>&#39;skypixel.yml&#39;</span><span class=p>)</span>
    <span class=n>testsets</span> <span class=o>=</span> <span class=n>utils</span><span class=o>.</span><span class=n>load_testcases_by_path</span><span class=p>(</span><span class=n>testcase_file_path</span><span class=p>)</span>
    <span class=n>testset</span> <span class=o>=</span> <span class=n>testsets</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</code></pre></td></tr></table>
</div>
</div><p>可以看出，整个文件中，只有测试用例文件的路径是与具体测试场景相关的，其它内容全都可以不变。</p>
<p>于是，针对不同的测试场景，我们只需要将<code>testcase_file_path</code>替换为接口测试用例文件的路径，即可实现对应场景的接口性能测试。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>➜  ApiTestEngine git:<span class=o>(</span>master<span class=o>)</span> ✗ locust -f locustfile.py
<span class=o>[</span>2017-08-27 11:30:01,829<span class=o>]</span> bogon/INFO/locust.main: Starting web monitor at *:8089
<span class=o>[</span>2017-08-27 11:30:01,831<span class=o>]</span> bogon/INFO/locust.main: Starting Locust 0.8a2
</code></pre></td></tr></table>
</div>
</div><p>后面的操作就完全是<a href=http://locust.io/><code>Locust</code></a>的内容了，使用方式完全一样。</p>
<p><img src=/images/locust-start.jpg alt></p>
<h2 id=优化1自动生成locustfile>优化1：自动生成locustfile</h2>
<p>通过前面的探索实践，我们基本上就实现了一份测试用例同时兼具接口自动化测试和接口性能测试的功能。</p>
<p>然而，在使用上还不够便捷，主要有两点：</p>
<ul>
<li>需要手工修改模板文件中的<code>testcase_file_path</code>路径；</li>
<li><code>locustfile.py</code>模板文件的路径必须放在<code>ApiTestEngine</code>的项目根目录下。</li>
</ul>
<p>于是，我产生了让<code>ApiTestEngine</code>框架本身自动生成<code>locustfile.py</code>文件的想法。</p>
<p>在实现这个想法的过程中，我想过两种方式。</p>
<p>第一种，通过分析<a href=http://locust.io/><code>Locust</code></a>的源码，可以看到<code>Locust</code>在<code>main.py</code>中具有一个<code>load_locustfile</code>方法，可以加载Python格式的文件，并提取出其中的<code>locust_classes</code>（也就是<code>Locust</code>的子类）；后续，就是将<code>locust_classes</code>作为参数传给<code>Locust</code>的<code>Runner</code>了。</p>
<p>若采用这种思路，我们就可以实现一个类似<code>load_locustfile</code>的方法，将<code>YAML/JSON</code>文件中的内容动态生成<code>locust_classes</code>，然后再传给<code>Locust</code>的<code>Runner</code>。这里面会涉及到动态地创建类和添加方法，好处是不需要生成<code>locustfile.py</code>中间文件，并且可以实现最大的灵活性，但缺点在于需要改变<a href=http://locust.io/><code>Locust</code></a>的源码，即重新实现<a href=http://locust.io/><code>Locust</code></a>的<code>main.py</code>中的多个函数。虽然难度不会太大，但考虑到后续需要与<a href=http://locust.io/><code>Locust</code></a>的更新保持一致，具有一定的维护工作量，便放弃了该种方案。</p>
<p>第二种，就是生成<code>locustfile.py</code>这样一个中间文件，然后将文件路径传给<code>Locust</code>。这样的好处在于我们可以不改变<a href=http://locust.io/><code>Locust</code></a>的任何地方，直接对其进行使用。与<a href=http://locust.io/><code>Locust</code></a>的传统使用方式差异在于，之前我们是在<code>Terminal</code>中通过参数启动<code>Locust</code>，而现在我们是在<code>ApiTestEngine</code>框架中通过Python代码启动<code>Locust</code>。</p>
<p>具体地，我在<code>setup.py</code>的<code>entry_points</code>中新增了一个命令<code>locusts</code>，并绑定了对应的程序入口。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>entry_points</span><span class=o>=</span><span class=p>{</span>
    <span class=s1>&#39;console_scripts&#39;</span><span class=p>:</span> <span class=p>[</span>
        <span class=s1>&#39;ate=ate.cli:main_ate&#39;</span><span class=p>,</span>
        <span class=s1>&#39;locusts=ate.cli:main_locust&#39;</span>
    <span class=p>]</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>在<code>ate/cli.py</code>中新增了<code>main_locust</code>函数，作为<code>locusts</code>命令的入口。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>main_locust</span><span class=p>():</span>
    <span class=s2>&#34;&#34;&#34; Performance test with locust: parse command line options and run commands.
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=kn>from</span> <span class=nn>locust.main</span> <span class=kn>import</span> <span class=n>main</span>
    <span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Locust is not installed, exit.&#34;</span><span class=p>)</span>
        <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>

    <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;locust&#39;</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
        <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=s2>&#34;-h&#34;</span><span class=p>])</span>

    <span class=k>if</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=ow>in</span> <span class=p>[</span><span class=s2>&#34;-h&#34;</span><span class=p>,</span> <span class=s2>&#34;--help&#34;</span><span class=p>,</span> <span class=s2>&#34;-V&#34;</span><span class=p>,</span> <span class=s2>&#34;--version&#34;</span><span class=p>]:</span>
        <span class=n>main</span><span class=p>()</span>
        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>

    <span class=k>try</span><span class=p>:</span>
        <span class=n>testcase_index</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=s1>&#39;-f&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
        <span class=k>assert</span> <span class=n>testcase_index</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span>
    <span class=k>except</span> <span class=p>(</span><span class=ne>ValueError</span><span class=p>,</span> <span class=ne>AssertionError</span><span class=p>):</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Testcase file is not specified, exit.&#34;</span><span class=p>)</span>
        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>

    <span class=n>testcase_file_path</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=n>testcase_index</span><span class=p>]</span>
    <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=n>testcase_index</span><span class=p>]</span> <span class=o>=</span> <span class=n>parse_locustfile</span><span class=p>(</span><span class=n>testcase_file_path</span><span class=p>)</span>
    <span class=n>main</span><span class=p>()</span>
</code></pre></td></tr></table>
</div>
</div><p>若你执行<code>locusts -V</code>或<code>locusts -h</code>，会发现效果与<code>locust</code>的特性完全一致。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ locusts -V
<span class=o>[</span>2017-08-27 12:41:27,740<span class=o>]</span> bogon/INFO/stdout: Locust 0.8a2
<span class=o>[</span>2017-08-27 12:41:27,740<span class=o>]</span> bogon/INFO/stdout:
</code></pre></td></tr></table>
</div>
</div><p>事实上，通过上面的代码（<code>main_locust</code>）也可以看出，<code>locusts</code>命令只是对<code>locust</code>进行了一层封装，用法基本等价。唯一的差异在于，当<code>-f</code>参数指定的是<code>YAML/JSON</code>格式的用例文件时，会先转换为Python格式的<code>locustfile.py</code>，然后再传给<code>locust</code>。</p>
<p>至于解析函数<code>parse_locustfile</code>，实现起来也很简单。我们只需要在框架中保存一份<code>locustfile.py</code>的模板文件（<code>ate/locustfile_template</code>），并将<code>testcase_file_path</code>采用占位符代替。然后，在解析函数中，就可以读取整个模板文件，将其中的占位符替换为<code>YAML/JSON</code>用例文件的实际路径，然后再保存为<code>locustfile.py</code>，并返回其路径即可。</p>
<p>具体的代码就不贴了，有兴趣的话可自行查看。</p>
<p>通过这一轮优化，<code>ApiTestEngine</code>就继承了<a href=http://locust.io/><code>Locust</code></a>的全部功能，并且可以直接指定<code>YAML/JSON</code>格式的文件启动<a href=http://locust.io/><code>Locust</code></a>执行性能测试。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ locusts -f examples/first-testcase.yml
<span class=o>[</span>2017-08-18 17:20:43,915<span class=o>]</span> Leos-MacBook-Air.local/INFO/locust.main: Starting web monitor at *:8089
<span class=o>[</span>2017-08-18 17:20:43,918<span class=o>]</span> Leos-MacBook-Air.local/INFO/locust.main: Starting Locust 0.8a2
</code></pre></td></tr></table>
</div>
</div><h2 id=优化2一键启动多个locust实例>优化2：一键启动多个locust实例</h2>
<p>经过第一轮优化后，本来应该是告一段落了，因为此时<code>ApiTestEngine</code>已经可以非常便捷地实现接口自动化测试和接口性能测试的切换了。</p>
<p>直到有一天，在<code>TesterHome</code>论坛讨论<code>Locust</code>的一个<a href=https://testerhome.com/topics/9277#reply-84542>回复</a>中，<a href=https://testerhome.com/keithmork><code>@keithmork</code></a>说了这么一句话。</p>
<blockquote>
<p>期待有一天<code>ApiTestEngine</code>的热度超过<code>Locust</code>本身</p>
</blockquote>
<p>看到这句话时我真的不禁泪流满面。虽然我也是一直在用心维护<code>ApiTestEngine</code>，却从未有过这样的奢望。</p>
<p>但反过来细想，为啥不能有这样的想法呢？当前<code>ApiTestEngine</code>已经继承了<code>Locust</code>的所有功能，在不影响<code>Locust</code>已有特性的同时，还可以采用<code>YAML/JSON</code>格式来编写维护测试用例，并实现了一份测试用例可同时用于接口自动化和接口性能测试的目的。</p>
<p>这些特性都是<code>Locust</code>所不曾拥有的，而对于使用者来说的确也都是比较实用的功能。</p>
<p>于是，新的目标在内心深处萌芽了，那就是在<code>ApiTestEngine</code>中通过对<code>Locust</code>更好的封装，让<code>Locust</code>的使用者体验更爽。</p>
<p>然后，我又想到了自己之前做的一个开源项目，<a href=https://github.com/debugtalk/Stormer><code>debugtalk/stormer</code></a>。当时做这个项目的初衷在于，当我们使用<code>Locust</code>进行压测时，要想使用压测机所有CPU的性能，就需要采用<code>master-slave</code>模式。因为<code>Locust</code>默认是单进程运行的，只能运行在压测机的一个CPU核上；而通过采用<code>master-slave</code>模式，启动多个<code>slave</code>，就可以让不同的<code>slave</code>运行在不同的CPU核上，从而充分发挥压测机多核处理器的性能。</p>
<p>而在实际使用<code>Locust</code>的时候，每次只能手动启动<code>master</code>，并依次手动启动多个<code>slave</code>。若遇到测试脚本调整的情况，就需要逐一结束<code>Locust</code>的所有进程，然后再重复之前的启动步骤。如果有使用过<code>Locust</code>的同学，应该对此痛苦的经历都有比较深的体会。当时也是基于这一痛点，我开发了<a href=https://github.com/debugtalk/Stormer><code>debugtalk/stormer</code></a>，目的就是可以一次性启动或销毁多个<code>Locust</code>实例。这个脚本做出来后，自己用得甚爽，也得到了<code>Github</code>上一些朋友的青睐。</p>
<p>既然现在要提升<code>ApiTestEngine</code>针对<code>Locust</code>的使用便捷性，那么这个特性毫无疑问也应该加进去。就此，<a href=https://github.com/debugtalk/Stormer><code>debugtalk/stormer</code></a>项目便被废弃，正式合并到<code>debugtalk/ApiTestEngine</code>。</p>
<p>想法明确后，实现起来也挺简单的。</p>
<p>原则还是保持不变，那就是不改变<a href=http://locust.io/><code>Locust</code></a>本身的特性，只在传参的时候在中间层进行操作。</p>
<p>具体地，我们可以新增一个<code>--full-speed</code>参数。当不指定该参数时，使用方式跟之前完全相同；而指定<code>--full-speed</code>参数后，就可以采用多进程的方式启动多个实例（实例个数等于压测机的处理器核数）。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>main_locust</span><span class=p>():</span>
    <span class=c1># do original work</span>

    <span class=k>if</span> <span class=s2>&#34;--full-speed&#34;</span> <span class=ow>in</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>:</span>
        <span class=n>locusts</span><span class=o>.</span><span class=n>run_locusts_at_full_speed</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>locusts</span><span class=o>.</span><span class=n>main</span><span class=p>()</span>
</code></pre></td></tr></table>
</div>
</div><p>具体实现逻辑在<code>ate/locusts.py</code>中：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>multiprocessing</span>
<span class=kn>from</span> <span class=nn>locust.main</span> <span class=kn>import</span> <span class=n>main</span>

<span class=k>def</span> <span class=nf>start_master</span><span class=p>(</span><span class=n>sys_argv</span><span class=p>):</span>
    <span class=n>sys_argv</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;--master&#34;</span><span class=p>)</span>
    <span class=n>sys</span><span class=o>.</span><span class=n>argv</span> <span class=o>=</span> <span class=n>sys_argv</span>
    <span class=n>main</span><span class=p>()</span>

<span class=k>def</span> <span class=nf>start_slave</span><span class=p>(</span><span class=n>sys_argv</span><span class=p>):</span>
    <span class=n>sys_argv</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=s2>&#34;--slave&#34;</span><span class=p>])</span>
    <span class=n>sys</span><span class=o>.</span><span class=n>argv</span> <span class=o>=</span> <span class=n>sys_argv</span>
    <span class=n>main</span><span class=p>()</span>

<span class=k>def</span> <span class=nf>run_locusts_at_full_speed</span><span class=p>(</span><span class=n>sys_argv</span><span class=p>):</span>
    <span class=n>sys_argv</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>sys_argv</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=s2>&#34;--full-speed&#34;</span><span class=p>))</span>
    <span class=n>slaves_num</span> <span class=o>=</span> <span class=n>multiprocessing</span><span class=o>.</span><span class=n>cpu_count</span><span class=p>()</span>

    <span class=n>processes</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>slaves_num</span><span class=p>):</span>
        <span class=n>p_slave</span> <span class=o>=</span> <span class=n>multiprocessing</span><span class=o>.</span><span class=n>Process</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>start_slave</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>sys_argv</span><span class=p>,))</span>
        <span class=n>p_slave</span><span class=o>.</span><span class=n>daemon</span> <span class=o>=</span> <span class=kc>True</span>
        <span class=n>p_slave</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
        <span class=n>processes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>p_slave</span><span class=p>)</span>

    <span class=k>try</span><span class=p>:</span>
        <span class=n>start_master</span><span class=p>(</span><span class=n>sys_argv</span><span class=p>)</span>
    <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</code></pre></td></tr></table>
</div>
</div><p>由此可见，关键点也就是使用了<code>multiprocessing.Process</code>，在不同的进程中分别调用<code>Locust</code>的<code>main()</code>函数，实现逻辑十分简单。</p>
<h2 id=最终实现效果>最终实现效果</h2>
<p>经过前面的优化，采用<code>ApiTestEngine</code>执行性能测试时，使用就十分便捷了。</p>
<p>安装<code>ApiTestEngine</code>后，系统中就具有了<code>locusts</code>命令，使用方式跟<code>Locust</code>框架的<code>locust</code>几乎完全相同，我们完全可以使用<code>locusts</code>命令代替原生的<code>locust</code>命令。</p>
<p>例如，下面的命令执行效果与<code>locust</code>完全一致。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ locusts -V
$ locusts -h
$ locusts -f locustfile.py
$ locusts -f locustfile.py --master -P <span class=m>8088</span>
$ locusts -f locustfile.py --slave <span class=p>&amp;</span>
</code></pre></td></tr></table>
</div>
</div><p>差异在于，<code>locusts</code>具有更加丰富的功能。</p>
<p>在<code>ApiTestEngine</code>中编写的<code>YAML/JSON</code>格式的接口测试用例文件，直接运行就可以启动<code>Locust</code>运行性能测试。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ locusts -f examples/first-testcase.yml
<span class=o>[</span>2017-08-18 17:20:43,915<span class=o>]</span> Leos-MacBook-Air.local/INFO/locust.main: Starting web monitor at *:8089
<span class=o>[</span>2017-08-18 17:20:43,918<span class=o>]</span> Leos-MacBook-Air.local/INFO/locust.main: Starting Locust 0.8a2
</code></pre></td></tr></table>
</div>
</div><p>加上<code>--full-speed</code>参数，就可以同时启动多个<code>Locust</code>实例（实例个数等于处理器核数），充分发挥压测机多核处理器的性能。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ locusts -f examples/first-testcase.yml --full-speed -P <span class=m>8088</span>
<span class=o>[</span>2017-08-26 23:51:47,071<span class=o>]</span> bogon/INFO/locust.main: Starting web monitor at *:8088
<span class=o>[</span>2017-08-26 23:51:47,075<span class=o>]</span> bogon/INFO/locust.main: Starting Locust 0.8a2
<span class=o>[</span>2017-08-26 23:51:47,078<span class=o>]</span> bogon/INFO/locust.main: Starting Locust 0.8a2
<span class=o>[</span>2017-08-26 23:51:47,080<span class=o>]</span> bogon/INFO/locust.main: Starting Locust 0.8a2
<span class=o>[</span>2017-08-26 23:51:47,083<span class=o>]</span> bogon/INFO/locust.main: Starting Locust 0.8a2
<span class=o>[</span>2017-08-26 23:51:47,084<span class=o>]</span> bogon/INFO/locust.runners: Client <span class=s1>&#39;bogon_656e0af8e968a8533d379dd252422ad3&#39;</span> reported as ready. Currently <span class=m>1</span> clients ready to swarm.
<span class=o>[</span>2017-08-26 23:51:47,085<span class=o>]</span> bogon/INFO/locust.runners: Client <span class=s1>&#39;bogon_09f73850252ee4ec739ed77d3c4c6dba&#39;</span> reported as ready. Currently <span class=m>2</span> clients ready to swarm.
<span class=o>[</span>2017-08-26 23:51:47,084<span class=o>]</span> bogon/INFO/locust.main: Starting Locust 0.8a2
<span class=o>[</span>2017-08-26 23:51:47,085<span class=o>]</span> bogon/INFO/locust.runners: Client <span class=s1>&#39;bogon_869f7ed671b1a9952b56610f01e2006f&#39;</span> reported as ready. Currently <span class=m>3</span> clients ready to swarm.
<span class=o>[</span>2017-08-26 23:51:47,085<span class=o>]</span> bogon/INFO/locust.runners: Client <span class=s1>&#39;bogon_80a804cda36b80fac17b57fd2d5e7cdb&#39;</span> reported as ready. Currently <span class=m>4</span> clients ready to swarm.
</code></pre></td></tr></table>
</div>
</div><p><img src=/images/locusts-full-speed.jpg alt></p>
<p>后续，<a href=https://github.com/debugtalk/ApiTestEngine><code>ApiTestEngine</code></a>将持续进行优化，欢迎大家多多反馈改进建议。</p>
<p>Enjoy!</p>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span class=item-title>文章作者</span>
<span class=item-content>debugtalk</span>
</p>
<p class=copyright-item>
<span class=item-title>上次更新</span>
<span class=item-content>
2017-08-27
</span>
</p>
<p class=copyright-item>
<span class=item-title>许可协议</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span>
</p>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=https://debugtalk.com/tags/HttpRunner/>HttpRunner</a>
<a href=https://debugtalk.com/tags/Locust/>Locust</a>
</div>
<nav class=post-nav>
<a class=prev href=/post/apitestengine-hot-plugin/>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg>
</i>
<span class="prev-text nav-default">约定大于配置：ApiTestEngine实现热加载机制</span>
<span class="prev-text nav-mobile">上一篇</span>
</a>
<a class=next href=/post/apitestengine-quickstart/>
<span class="next-text nav-default">ApiTestEngine QuickStart</span>
<span class="prev-text nav-mobile">下一篇</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697c-11.777231-11.500939-30.216186-10.304694-41.178865 2.712784z"/></svg>
</i>
</a>
</nav>
</footer>
</article>
<div class="post bg-white">
<script src=https://utteranc.es/client.js repo=debugtalk/debugtalk.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script>
</div>
</div>
</div>
</main>
<footer id=footer class=footer>
<div class=icon-links>
<a href=mailto:mail@debugtalk.com rel="me noopener" class=iconfont title=email><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408h399.992405s71.046998 3.997201 71.046998 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zm53.281707 130.131124C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523S0 1024 83.726336 1024H682.532949 753.579947h595.368192C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955c-39.771477 34.470494-74.671786 43.295855-98.955861 43.868928z"/></svg>
</a>
<a href=https://github.com/debugtalk rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04C242.005334 929.664 211.968 830.08 211.968 830.08 188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg>
</a>
<a href=https://debugtalk.com/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg>
</a>
</div>
<div class=copyright>
<span class=power-by>
Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span>
<span class=division>|</span>
<span class=theme-info>
Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a>
</span>
<span class=copyright-year>
&copy;
2011 -
2022
<span class=heart>
<i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg>
</i>
</span><span class=author>
debugtalk
</span></span>
<span id=busuanzi_container>
访客数/访问量：<span id=busuanzi_value_site_uv></span>/<span id=busuanzi_value_site_pv></span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg>
</i>
</div>
</div>
<script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/load-photoswipe.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script src=/js/custom.js></script>
</body>
</html>