<!doctype html><html lang=zh-cn itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>HttpRunner 通过 skip 机制实现对测试用例的分组执行控制 - DebugTalk</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes">
<meta name=MobileOptimized content="width">
<meta name=HandheldFriendly content="true">
<meta name=applicable-device content="pc,mobile">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=mobile-web-app-capable content="yes">
<meta name=author content="debugtalk">
<meta name=description content="背景介绍 近期，某位同学对HttpRunner提了一个需求点： 能否支持类似unittest中的skip注解，方便灵活剔除某些用例，不执行。 目前">
<meta name=keywords content="HttpRunner,Python,Go,博客,debugtalk,接口自动化测试,性能测试">
<meta name=generator content="Hugo 0.92.1">
<link rel=canonical href=https://debugtalk.com/post/HttpRunner-skip-feature/>
<link rel=icon href=/favicon.ico>
<link rel=stylesheet href=/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css integrity="sha256-+ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media=screen crossorigin=anonymous>
<link rel=stylesheet href=/css/custom.css>
<meta property="og:title" content="HttpRunner 通过 skip 机制实现对测试用例的分组执行控制">
<meta property="og:description" content="背景介绍 近期，某位同学对HttpRunner提了一个需求点： 能否支持类似unittest中的skip注解，方便灵活剔除某些用例，不执行。 目前">
<meta property="og:type" content="article">
<meta property="og:url" content="https://debugtalk.com/post/HttpRunner-skip-feature/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2018-02-08T00:00:00+00:00">
<meta property="article:modified_time" content="2018-02-08T00:00:00+00:00">
<meta itemprop=name content="HttpRunner 通过 skip 机制实现对测试用例的分组执行控制">
<meta itemprop=description content="背景介绍 近期，某位同学对HttpRunner提了一个需求点： 能否支持类似unittest中的skip注解，方便灵活剔除某些用例，不执行。 目前"><meta itemprop=datePublished content="2018-02-08T00:00:00+00:00">
<meta itemprop=dateModified content="2018-02-08T00:00:00+00:00">
<meta itemprop=wordCount content="2384">
<meta itemprop=keywords content="HttpRunner,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="HttpRunner 通过 skip 机制实现对测试用例的分组执行控制">
<meta name=twitter:description content="背景介绍 近期，某位同学对HttpRunner提了一个需求点： 能否支持类似unittest中的skip注解，方便灵活剔除某些用例，不执行。 目前"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-81639610-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>DebugTalk</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.com/>主页</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.com/post/>归档</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.com/tags/>标签</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.com/categories/>分类</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.com/about/>关于</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://debugtalk.com/index.xml>订阅</a>
</li>
</ul>
</nav>
<link rel=stylesheet href=/lib/photoswipe/photoswipe.min.css>
<link rel=stylesheet href=/lib/photoswipe/default-skin/default-skin.min.css>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<header id=header class="header container">
<div class=logo-wrapper>
<a href=/ class=logo>
DebugTalk
</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.com/>主页</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.com/post/>归档</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.com/tags/>标签</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.com/categories/>分类</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.com/about/>关于</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://debugtalk.com/index.xml>订阅</a>
</li>
</ul>
</nav>
</header>
<div id=mobile-panel>
<main id=main class="main bg-llight">
<div class=content-wrapper>
<div id=content class="content container">
<article class="post bg-white">
<header class=post-header>
<h1 class=post-title>HttpRunner 通过 skip 机制实现对测试用例的分组执行控制</h1>
<div class=post-meta>
<time datetime=2018-02-08 class=post-time>
2018-02-08
</time>
<div class=post-category>
<a href=https://debugtalk.com/categories/OpenSource/> OpenSource </a>
</div>
<span class=more-meta> 约 2384 字 </span>
<span class=more-meta> 预计阅读 5 分钟 </span>
<span id=busuanzi_container_page_pv>
| 阅读 <span id=busuanzi_value_page_pv></span>
</span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>文章目录</h2>
<div class=post-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#背景介绍>背景介绍</a></li>
<li><a href=#实现方式>实现方式</a></li>
<li><a href=#效果展示>效果展示</a></li>
</ul>
</nav>
</div>
</div>
<div class=post-content>
<h2 id=背景介绍>背景介绍</h2>
<p>近期，某位同学对<code>HttpRunner</code>提了一个<a href=https://github.com/HttpRunner/HttpRunner/issues/96>需求点</a>：</p>
<blockquote>
<p>能否支持类似unittest中的skip注解，方便灵活剔除某些用例，不执行。
目前在接口测试日常构建中，会遇到一些接口开发暂时屏蔽了或者降级，导致用例执行失败；所以想当遇到这些情况的时候，能够临时剔除掉某些用例不执行；等后续恢复后，再去掉，然后恢复执行。</p>
</blockquote>
<p>针对这种情况，<code>HttpRunner</code>的确没有直接支持。之所以说是没有<code>直接</code>支持，是因为在<code>HttpRunner</code>中存在<code>times</code>关键字，可以指定某个<code>test</code>的运行次数。</p>
<p>例如，如下<code>test</code>中指定了<code>times</code>为3，那么该<code>test</code>就会运行3次。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml>- <span class=nt>test</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>demo</span><span class=w>
</span><span class=w>    </span><span class=nt>times</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span><span class=w>    </span><span class=nt>request</span><span class=p>:</span><span class=w> </span>{<span class=l>...}</span><span class=w>
</span><span class=w>    </span><span class=nt>validate</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>...]</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><p>假如要实现临时屏蔽掉某些<code>test</code>，那么就可以将对应<code>test</code>的<code>times</code>设置为0。</p>
<p>这虽然也能勉强实现需求，但是这跟直接将临时不运行的<code>test</code>注释掉没什么区别，都需要对测试用例内容进行改动，使用上很是不方便。</p>
<p>考虑到该需求的普遍性，<code>HttpRunner</code>的确应该增加对该种情况的支持。</p>
<p>在这方面，<code>unittest</code>已经有了清晰的定义，有三种常用的装饰器可以控制单元测试用例是否被执行：</p>
<ul>
<li>@unittest.skip(reason)：无条件跳过当前测试用例</li>
<li>@unittest.skipIf(condition, reason)：当条件表达式的值为true时跳过当前测试用例</li>
<li>@unittest.skipUnless(condition, reason)：当条件表达式的值为false时跳过当前测试用例</li>
</ul>
<p>该功能完全满足我们的需求，因此，我们可以直接复用其概念，尝试实现同样的功能。</p>
<h2 id=实现方式>实现方式</h2>
<p>目标明确了，那需要怎么实现呢？</p>
<p>首先，我们先看下<code>unittest</code>中这三个函数是怎么实现的；这三个函数定义在<code>unittest/case.py</code>中。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>class</span> <span class=nc>SkipTest</span><span class=p>(</span><span class=ne>Exception</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;
</span><span class=s2>    Raise this exception in a test to skip it.
</span><span class=s2>
</span><span class=s2>    Usually you can use TestCase.skipTest() or one of the skipping decorators
</span><span class=s2>    instead of raising this directly.
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=k>pass</span>

<span class=k>def</span> <span class=nf>skip</span><span class=p>(</span><span class=n>reason</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;
</span><span class=s2>    Unconditionally skip a test.
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=k>def</span> <span class=nf>decorator</span><span class=p>(</span><span class=n>test_item</span><span class=p>):</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>test_item</span><span class=p>,</span> <span class=p>(</span><span class=nb>type</span><span class=p>,</span> <span class=n>types</span><span class=o>.</span><span class=n>ClassType</span><span class=p>)):</span>
            <span class=nd>@functools</span><span class=o>.</span><span class=n>wraps</span><span class=p>(</span><span class=n>test_item</span><span class=p>)</span>
            <span class=k>def</span> <span class=nf>skip_wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
                <span class=k>raise</span> <span class=n>SkipTest</span><span class=p>(</span><span class=n>reason</span><span class=p>)</span>
            <span class=n>test_item</span> <span class=o>=</span> <span class=n>skip_wrapper</span>

        <span class=n>test_item</span><span class=o>.</span><span class=n>__unittest_skip__</span> <span class=o>=</span> <span class=kc>True</span>
        <span class=n>test_item</span><span class=o>.</span><span class=n>__unittest_skip_why__</span> <span class=o>=</span> <span class=n>reason</span>
        <span class=k>return</span> <span class=n>test_item</span>
    <span class=k>return</span> <span class=n>decorator</span>

<span class=k>def</span> <span class=nf>skipIf</span><span class=p>(</span><span class=n>condition</span><span class=p>,</span> <span class=n>reason</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;
</span><span class=s2>    Skip a test if the condition is true.
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=k>if</span> <span class=n>condition</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>skip</span><span class=p>(</span><span class=n>reason</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>_id</span>

<span class=k>def</span> <span class=nf>skipUnless</span><span class=p>(</span><span class=n>condition</span><span class=p>,</span> <span class=n>reason</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;
</span><span class=s2>    Skip a test unless the condition is true.
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>condition</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>skip</span><span class=p>(</span><span class=n>reason</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>_id</span>
</code></pre></td></tr></table>
</div>
</div><p>不难看出，核心有两点：</p>
<ul>
<li>对于<code>skip</code>，只需要在该测试用例中<code>raise SkipTest(reason)</code>，而<code>SkipTest</code>是<code>unittest/case.py</code>中定义的一个异常类；</li>
<li>对于<code>skipIf</code>和<code>skipUnless</code>，相比于<code>skip</code>，主要是需要指定一个条件表达式（condition），然后根据该表达式的实际值来决定是否<code>skip</code>当前测试用例。</li>
</ul>
<p>明确了这两点之后，我们要如何在<code>HttpRunner</code>中实现同样的功能，思路应该就比较清晰了。</p>
<p>因为<code>HttpRunner</code>同样也是采用<code>unittest</code>来组织和驱动测试用例执行的，而具体的执行控制部分都是在<code>httprunner/runner.py</code>的<code>_run_test</code>方法中；同时，在<code>_run_test</code>方法中会传入<code>testcase_dict</code>，也就是具体测试用例的全部信息。</p>
<p>那么，最简单的做法，就是在<code>YAML/JSON</code>测试用例中，新增<code>skip/skipIf/skipUnless</code>参数，然后在<code>_run_test</code>方法中根据参数内容来决定是否执行<code>raise SkipTest(reason)</code>。</p>
<p>例如，在<code>YAML</code>测试用例中，我们可以按照如下形式新增<code>skip</code>字段，其中对应的值部分就是我们需要的<code>reason</code>。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml>- <span class=nt>test</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>demo</span><span class=w>
</span><span class=w>    </span><span class=nt>skip</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;skip this test unconditionally&#34;</span><span class=w>
</span><span class=w>    </span><span class=nt>request</span><span class=p>:</span><span class=w> </span>{<span class=l>...}</span><span class=w>
</span><span class=w>    </span><span class=nt>validate</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>...]</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><p>接下来在<code>_run_test</code>方法，要处理就十分简单，只需要判断<code>testcase_dict</code>中是否包含<code>skip</code>字段，假如包含，则执行<code>raise SkipTest(reason)</code>即可。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>_run_test</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>testcase_dict</span><span class=p>):</span>
    <span class=o>...</span>

    <span class=k>if</span> <span class=s2>&#34;skip&#34;</span> <span class=ow>in</span> <span class=n>testcase_dict</span><span class=p>:</span>
        <span class=n>skip_reason</span> <span class=o>=</span> <span class=n>testcase_dict</span><span class=p>[</span><span class=s2>&#34;skip&#34;</span><span class=p>]</span>
        <span class=k>raise</span> <span class=n>SkipTest</span><span class=p>(</span><span class=n>skip_reason</span><span class=p>)</span>

    <span class=o>...</span>
</code></pre></td></tr></table>
</div>
</div><p>这对于<code>skip</code>机制来做，完全满足需求；但对于<code>skipIf/skipUnless</code>，可能就会麻烦些，因为我们的用例是在<code>YAML/JSON</code>文本格式的文件中，没法像在<code>unittest</code>中执行<code>condition</code>那样的Python表达式。</p>
<p>嗯？谁说在<code>YAML/JSON</code>中就不能执行函数表达式的？在<code>HttpRunner</code>中，我们已经实现了该功能，即：</p>
<ul>
<li>在<code>debugtalk.py</code>中定义函数，例如<code>func(a, b)</code></li>
<li>在<code>YAML/JSON</code>中通过<code>${func(a,b)}</code>对函数进行调用</li>
</ul>
<p>在此基础上，我们要实现<code>skipIf/skipUnless</code>就很简单了；很自然地，我们可以想到采用如下形式来进行描述。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml>- <span class=nt>test</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>create user which existed (skip if condition)</span><span class=w>
</span><span class=w>    </span><span class=nt>skipIf</span><span class=p>:</span><span class=w> </span><span class=l>${skip_test_in_production_env()}</span><span class=w>
</span><span class=w>    </span><span class=nt>request</span><span class=p>:</span><span class=w> </span>{<span class=l>...}</span><span class=w>
</span><span class=w>    </span><span class=nt>validate</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>...]</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><p>其中，<code>skip_test_in_production_env</code>定义在<code>debugtalk.py</code>文件中。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>skip_test_in_production_env</span><span class=p>():</span>
    <span class=s2>&#34;&#34;&#34; skip this test in production environment
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=k>return</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&#34;TEST_ENV&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;PRODUCTION&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>然后，在<code>_run_test</code>方法中，我们只需要判断<code>testcase_dict</code>中是否包含<code>skipIf</code>字段，假如包含，则将其对应的函数表达式取出，运行得到其结果，最后再根据运算结果来判断是否执行<code>raise SkipTest(reason)</code>。对函数表达式进行解析的方法在<code>httprunner/context.py</code>的<code>exec_content_functions</code>函数中，具体实现方式可阅读之前的文章。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>_run_test</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>testcase_dict</span><span class=p>):</span>
    <span class=o>...</span>

    <span class=k>if</span> <span class=s2>&#34;skip&#34;</span> <span class=ow>in</span> <span class=n>testcase_dict</span><span class=p>:</span>
        <span class=n>skip_reason</span> <span class=o>=</span> <span class=n>testcase_dict</span><span class=p>[</span><span class=s2>&#34;skip&#34;</span><span class=p>]</span>
        <span class=k>raise</span> <span class=n>SkipTest</span><span class=p>(</span><span class=n>skip_reason</span><span class=p>)</span>
    <span class=k>elif</span> <span class=s2>&#34;skipIf&#34;</span> <span class=ow>in</span> <span class=n>testcase_dict</span><span class=p>:</span>
        <span class=n>skip_if_condition</span> <span class=o>=</span> <span class=n>testcase_dict</span><span class=p>[</span><span class=s2>&#34;skipIf&#34;</span><span class=p>]</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>context</span><span class=o>.</span><span class=n>exec_content_functions</span><span class=p>(</span><span class=n>skip_if_condition</span><span class=p>):</span>
            <span class=n>skip_reason</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> evaluate to True&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>skip_if_condition</span><span class=p>)</span>
            <span class=k>raise</span> <span class=n>SkipTest</span><span class=p>(</span><span class=n>skip_reason</span><span class=p>)</span>

    <span class=o>...</span>
</code></pre></td></tr></table>
</div>
</div><p><code>skipUnless</code>与<code>skipIf</code>类似，不再重复。</p>
<p>通过该种方式，我们就可以实现在不对测试用例文件做任何修改的情况下，通过外部方式（例如设定环境变量的值）就可以控制是否执行某些测试用例。</p>
<h2 id=效果展示>效果展示</h2>
<p><code>skip/skipIf/skipUnless</code>机制实现后，我们对测试用例的执行控制就更加灵活方便了。</p>
<p>例如，我们可以很容易地实现如下常见的测试场景：</p>
<ul>
<li>对测试用例进行分组，P0/P1/P2等，然后根据实际需求选择执行哪些用例</li>
<li>通过环境变量来控制是否执行某些用例</li>
</ul>
<p>更重要的是，我们无需对测试用例文件进行任何修改。</p>
<p>在<code>HttpRunner</code>项目中存在一个示例文件，<a href=https://github.com/HttpRunner/HttpRunner/blob/master/tests/data/demo_testset_cli.yml><code>httprunner/tests/data/demo_testset_cli.yml</code></a>，大家可以此作为参考。</p>
<p>在运行该测试集后，生成的测试报告如下所示。</p>
<p><img src=/images/httprunner-skip.jpg alt></p>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span class=item-title>文章作者</span>
<span class=item-content>debugtalk</span>
</p>
<p class=copyright-item>
<span class=item-title>上次更新</span>
<span class=item-content>
2018-02-08
</span>
</p>
<p class=copyright-item>
<span class=item-title>许可协议</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span>
</p>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=https://debugtalk.com/tags/HttpRunner/>HttpRunner</a>
</div>
<nav class=post-nav>
<a class=prev href=/post/httprunner-data-driven/>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg>
</i>
<span class="prev-text nav-default">HttpRunner 实现参数化数据驱动机制</span>
<span class="prev-text nav-mobile">上一篇</span>
</a>
<a class=next href=/post/my-2017-summary/>
<span class="next-text nav-default">我的 2017 年终总结</span>
<span class="prev-text nav-mobile">下一篇</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697c-11.777231-11.500939-30.216186-10.304694-41.178865 2.712784z"/></svg>
</i>
</a>
</nav>
</footer>
</article>
<div class="post bg-white">
<script src=https://utteranc.es/client.js repo=debugtalk/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script>
</div>
<div class=disqus-comment>
<div class=disqus-button id=load_disqus onclick=load_disqus()>
显示 Disqus 评论
</div>
<div id=disqus_thread></div>
<script type=text/javascript>var disqus_config=function(){this.page.url="https://debugtalk.com/post/HttpRunner-skip-feature/"};function load_disqus(){var a,b;if(window.location.hostname==='localhost')return;a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='debugtalk',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a),$('#load_disqus').remove()}</script>
<noscript>Please enable JavaScript to view the
<a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a>
</noscript>
</div>
</div>
</div>
</main>
<footer id=footer class=footer>
<div class=icon-links>
<a href=mailto:mail@debugtalk.com rel="me noopener" class=iconfont title=email><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408h399.992405s71.046998 3.997201 71.046998 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zm53.281707 130.131124C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523S0 1024 83.726336 1024H682.532949 753.579947h595.368192C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955c-39.771477 34.470494-74.671786 43.295855-98.955861 43.868928z"/></svg>
</a>
<a href=https://github.com/debugtalk rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04C242.005334 929.664 211.968 830.08 211.968 830.08 188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg>
</a>
<a href=https://debugtalk.com/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg>
</a>
</div>
<div class=copyright>
<span class=power-by>
Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span>
<span class=division>|</span>
<span class=theme-info>
Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a>
</span>
<span class=copyright-year>
&copy;
2015 -
2022
<span class=heart>
<i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg>
</i>
</span><span class=author>
debugtalk
</span></span>
<span id=busuanzi_container>
访客数/访问量：<span id=busuanzi_value_site_uv></span>/<span id=busuanzi_value_site_pv></span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg>
</i>
</div>
</div>
<script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/load-photoswipe.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script src=/js/custom.js></script>
</body>
</html>